moqui.urlExtensions={js:"js",vue:"vue",vuet:"vuet"};window.define||(window.define=function(a,b,c){moqui.isString(a)||(c=b,b=a);moqui.isArray(b)||(c=b);return moqui.isFunction(c)?c():c});Vue.filter("decodeHtml",moqui.htmlDecode);Vue.filter("format",moqui.format);moqui.notifyOpts={delay:1500,timer:500,offset:{x:20,y:60},placement:{from:"top",align:"right"},z_index:1100,type:"success",animate:{enter:"animated fadeInDown",exit:""}};
moqui.notifyOptsInfo={delay:5E3,timer:500,offset:{x:20,y:60},placement:{from:"top",align:"right"},z_index:1100,type:"info",animate:{enter:"animated fadeInDown",exit:""}};moqui.notifyOptsError={delay:15E3,timer:500,offset:{x:20,y:60},placement:{from:"top",align:"right"},z_index:1100,type:"danger",animate:{enter:"animated fadeInDown",exit:""}};
moqui.notifyMessages=function(a,b,c){var d=!1;if(a)if(moqui.isArray(a))for(var e=0;e<a.length;e++){d=a[e];if(moqui.isPlainObject(d)){var f=d.type;f&&f.length||(f="info");$.notify(new moqui.NotifyOptions(d.message,null,f,null),$.extend({},moqui.notifyOptsInfo,{type:f}));moqui.webrootVue.addNotify(d.message,f)}else $.notify(new moqui.NotifyOptions(d,null,"info",null),moqui.notifyOptsInfo),moqui.webrootVue.addNotify(d,"info");d=!0}else $.notify(new moqui.NotifyOptions(a,null,"info",null),moqui.notifyOptsInfo),
moqui.webrootVue.addNotify(a,"info"),d=!0;if(b)if(moqui.isArray(b))for(a=0;a<b.length;a++)$.notify(new moqui.NotifyOptions(b[a],null,"info",null),moqui.notifyOptsError),moqui.webrootVue.addNotify(b[a],"danger"),d=!0;else $.notify(new moqui.NotifyOptions(b,null,"info",null),moqui.notifyOptsError),moqui.webrootVue.addNotify(b,"danger"),d=!0;if(c)if(moqui.isArray(c))for(b=0;b<c.length;b++)moqui.notifyValidationError(c[b]),d=!0;else moqui.notifyValidationError(c),d=!0;return d};
moqui.notifyValidationError=function(a){var b=a;moqui.isPlainObject(a)&&(b=a.message,a.fieldPretty&&a.fieldPretty.length&&(b=b+" (for field "+a.fieldPretty+")"));$.notify(new moqui.NotifyOptions(b,null,"info",null),moqui.notifyOptsError);moqui.webrootVue.addNotify(b,"danger")};
moqui.handleAjaxError=function(a,b,c){var d=a.responseText,e;try{e=JSON.parse(d)}catch(g){}console.warn("ajax "+b+" ("+a.status+"), message "+c);var f=!1;401===a.status?f=moqui.notifyMessages(null,"No user authenticated"):e&&moqui.isPlainObject(e)?f=moqui.notifyMessages(e.messageInfos,e.errors,e.validationErrors):d&&moqui.isString(d)&&d.length&&(f=moqui.notifyMessages(d));401===a.status?moqui.webrootVue?window.location.href=moqui.webrootVue.currentLinkUrl:window.location.reload(!0):0===a.status?0>
c.indexOf("abort")&&($.notify(new moqui.NotifyOptions("Could not connect to server",null,"danger",null),moqui.notifyOptsError),moqui.webrootVue.addNotify("Could not connect to server","danger")):f||(a="Error: "+c+" ("+b+")",$.notify(new moqui.NotifyOptions(a,null,"danger",null),moqui.notifyOptsError),moqui.webrootVue.addNotify(a,"danger"))};moqui.componentCache=new moqui.LruMap(50);
moqui.handleLoadError=function(a,b,c){"abort"===b?console.warn("load aborted: "+b+" ("+a.status+"), message "+c):(moqui.webrootVue.loading=0,moqui.handleAjaxError(a,b,c))};
moqui.loadComponent=function(a,b,c){var d=moqui.urlExtensions.js,e=moqui.urlExtensions.vue,f=moqui.urlExtensions.vuet,g,h,k,l;if("string"===typeof a){var n=a.indexOf("?");0<n?(g=a.slice(0,n),k=a.slice(n+1)):g=a}else g=a.path,h=a.extraPath,k=a.search,l=a.bodyParameters;var m=g;a.renderModes&&0<=a.renderModes.indexOf(e)&&(m+="."+e);if(m.slice(-e.length)===e)return console.info("loadComponent vue "+m+(c?" id "+c:"")),a={type:"GET",url:m,error:moqui.handleLoadError,success:function(a,c,d){205===d.status?
(a=d.getResponseHeader("X-Redirect-To"),moqui.webrootVue.setUrl(a)):(a||b(moqui.NotFound),c=(c=d.getResponseHeader("Cache-Control"))&&0<=c.indexOf("max-age"),moqui.isString(a)&&0<a.length?(a=httpVueLoader.parse(a,m.substr(0,m.lastIndexOf("/")+1)),c&&moqui.componentCache.put(g,a),b(a)):b(moqui.NotFound))}},l&&!$.isEmptyObject(l)&&(a.type="POST",a.data=l),$.ajax(a);var p=g.slice(-d.length)===d;!p&&a.renderModes&&0<=a.renderModes.indexOf(d)&&(m+="."+d,p=!0);p||(m+="."+f);h&&0<h.length&&(m+="/"+h);k&&
0<k.length&&(m+="?"+k);console.info("loadComponent "+m+(c?" id "+c:""));a={type:"GET",url:m,error:moqui.handleLoadError,success:function(a,e,k){if(205===k.status)a=k.getResponseHeader("X-Redirect-To"),moqui.webrootVue.setUrl(a);else{a||b(moqui.NotFound);var l=0<=k.getResponseHeader("Cache-Control").indexOf("max-age");if(moqui.isString(a)&&0<a.length)if(p||"define("===a.slice(0,7)){console.info("loaded JS from "+m+(c?" id "+c:""));var h=eval(a);h.template?(l&&moqui.componentCache.put(g,h),b(h)):(a=
(g.slice(-d.length)===d?g.slice(0,-d.length):g)+"."+f,$.ajax({type:"GET",url:a,error:moqui.handleLoadError,success:function(a){h.template=a;l&&moqui.componentCache.put(g,h);b(h)}}))}else a=a.replace(/<script/g,"\x3cm-script").replace(/<\/script>/g,"\x3c/m-script\x3e").replace(/<link/g,"\x3cm-stylesheet"),console.info("loaded HTML template from "+m+(c?" id "+c:"")),a={template:"\x3cdiv"+(c&&0<c.length?' id\x3d"'+c+'"':"")+"\x3e"+a+"\x3c/div\x3e"},l&&moqui.componentCache.put(g,a),b(a);else moqui.isPlainObject(a)?
a.screenUrl&&a.screenUrl.length?moqui.webrootVue.setUrl(a.screenUrl):a.redirectUrl&&a.redirectUrl.length&&window.location.replace(a.redirectUrl):b(moqui.NotFound)}}};l&&!$.isEmptyObject(l)&&(a.type="POST",a.data=l);return $.ajax(a)};moqui.NotFound=Vue.extend({template:'\x3cdiv id\x3d"current-page-root"\x3e\x3ch4\x3eScreen not found at {{this.$root.currentPath}}\x3c/h4\x3e\x3c/div\x3e'});moqui.EmptyComponent=Vue.extend({template:'\x3cdiv id\x3d"current-page-root"\x3e\x3cdiv class\x3d"spinner"\x3e\x3cdiv\x3e\x26nbsp;\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'});
Vue.component("m-link",{props:{href:{type:String,required:!0},loadId:String,confirmation:String},template:'\x3ca :href\x3d"linkHref" @click.prevent\x3d"go"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/a\x3e',methods:{go:function(a){0!==a.button||this.confirmation&&this.confirmation.length&&!window.confirm(this.confirmation)||(this.loadId&&0<this.loadId.length?this.$root.loadContainer(this.loadId,this.href):a.ctrlKey||a.metaKey?window.open(this.linkHref,"_blank"):this.$root.setUrl(this.linkHref))}},computed:{linkHref:function(){return this.$root.getLinkPath(this.href)}}});
Vue.component("m-script",{props:{src:String,type:{type:String,"default":"text/javascript"}},template:'\x3cdiv :type\x3d"type" style\x3d"display:none;"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/div\x3e',created:function(){this.src&&0<this.src.length&&moqui.loadScript(this.src)},mounted:function(){var a=this.$el.innerText;a&&0<a.trim().length&&moqui.retryInlineScript(a,1)}});
Vue.component("m-stylesheet",{props:{href:{type:String,required:!0},rel:{type:String,"default":"stylesheet"},type:{type:String,"default":"text/css"}},template:'\x3cdiv :type\x3d"type" style\x3d"display:none;"\x3e\x3c/div\x3e',created:function(){moqui.loadStylesheet(this.href,this.rel,this.type)}});
Vue.component("container-box",{props:{type:{type:String,"default":"default"},title:String,initialOpen:{type:Boolean,"default":!0}},data:function(){return{isBodyOpen:this.initialOpen}},template:'\x3cdiv :class\x3d"\'panel panel-\' + type"\x3e\x3cdiv class\x3d"panel-heading" @click.self\x3d"toggleBody"\x3e\x3ch5 v-if\x3d"title \x26\x26 title.length" @click\x3d"toggleBody"\x3e\x3ci :class\x3d"[isBodyOpen?\'fa fa-chevron-down\':\'fa fa-chevron-right\']"/\x3e {{title}}\x3c/h5\x3e\x3cslot name\x3d"header"\x3e\x3c/slot\x3e\x3cdiv class\x3d"panel-toolbar"\x3e\x3cslot name\x3d"toolbar"\x3e\x3c/slot\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"panel-collapse collapse" :class\x3d"{in:isBodyOpen}"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/div\x3e\x3c/div\x3e',methods:{toggleBody:function(){this.isBodyOpen=
!this.isBodyOpen}}});Vue.component("box-body",{props:{height:String},data:function(){return this.height?{dialogStyle:{"max-height":this.height+"px","overflow-y":"auto"}}:{dialogStyle:{}}},template:'\x3cdiv class\x3d"panel-body" :style\x3d"dialogStyle"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/div\x3e'});
Vue.component("container-dialog",{props:{id:{type:String,required:!0},title:String,width:{type:String,"default":"760"},openDialog:{type:Boolean,"default":!1}},data:function(){var a=$(window).width();return{isHidden:!0,dialogStyle:{width:(this.width<a?this.width:a)+"px"}}},template:'\x3cdiv :id\x3d"id" class\x3d"modal dynamic-dialog" aria-hidden\x3d"true" style\x3d"display:none;" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"modal-dialog" :style\x3d"dialogStyle"\x3e\x3cdiv class\x3d"modal-content"\x3e\x3cdiv class\x3d"modal-header"\x3e\x3cbutton type\x3d"button" class\x3d"close" data-dismiss\x3d"modal" aria-hidden\x3d"true"\x3e\x26times;\x3c/button\x3e\x3ch4 class\x3d"modal-title"\x3e{{title}}\x3c/h4\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-body"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
methods:{hide:function(){$(this.$el).modal("hide")}},mounted:function(){var a=$(this.$el),b=this;a.on("hidden.bs.modal",function(){b.isHidden=!0});a.on("shown.bs.modal",function(){b.isHidden=!1;a.find(":not(.noResetSelect2)\x3eselect:not(.noResetSelect2)").select2({});var c=a.find(".default-focus");c.length?c.focus():a.find("form :input:visible:not([type\x3d'submit']):first").focus()});this.openDialog&&a.modal("show")}});
Vue.component("dynamic-container",{props:{id:{type:String,required:!0},url:{type:String}},data:function(){return{curComponent:moqui.EmptyComponent,curUrl:""}},template:'\x3ccomponent :is\x3d"curComponent"\x3e\x3c/component\x3e',methods:{reload:function(){var a=this.curUrl;this.curUrl="";var b=this;setTimeout(function(){b.curUrl=a},20)},load:function(a){this.curUrl===a?this.reload():this.curUrl=a}},watch:{curUrl:function(a){if(a&&0!==a.length){var b=this;moqui.loadComponent(a,function(a){b.curComponent=
a},this.id)}else this.curComponent=moqui.EmptyComponent}},mounted:function(){this.$root.addContainer(this.id,this);this.curUrl=this.url}});
Vue.component("dynamic-dialog",{props:{id:{type:String,required:!0},url:{type:String,required:!0},title:String,width:{type:String,"default":"760"},openDialog:{type:Boolean,"default":!1},dynamicParams:{type:Object,"default":null}},data:function(){var a=$(window).width();return{curComponent:moqui.EmptyComponent,curUrl:"",isHidden:!0,dialogStyle:{width:(this.width<a?this.width:a)+"px"}}},template:'\x3cdiv :id\x3d"id" class\x3d"modal dynamic-dialog" aria-hidden\x3d"true" style\x3d"display: none;" tabindex\x3d"-1"\x3e\x3cdiv class\x3d"modal-dialog" :style\x3d"dialogStyle"\x3e\x3cdiv class\x3d"modal-content"\x3e\x3cdiv class\x3d"modal-header"\x3e\x3cbutton type\x3d"button" class\x3d"close" data-dismiss\x3d"modal" aria-hidden\x3d"true"\x3e\x26times;\x3c/button\x3e\x3ch4 class\x3d"modal-title"\x3e{{title}}\x3c/h4\x3e\x3c/div\x3e\x3cdiv class\x3d"modal-body"\x3e\x3ccomponent :is\x3d"curComponent"\x3e\x3c/component\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
methods:{reload:function(){if(!this.isHidden){var a=$(this.$el);a.modal("hide");a.modal("show")}},load:function(a){this.curUrl=a},hide:function(){$(this.$el).modal("hide")}},watch:{curUrl:function(a){if(a&&0!==a.length){var b=this;if(moqui.isPlainObject(this.dynamicParams)){var c="";$.each(this.dynamicParams,function(a,b){var f=$("#"+b).val();f&&f.length&&(c=c+(0<c.length?"\x26":"")+a+"\x3d"+f)});c.length&&(a=a+(0<a.indexOf("?")?"\x26":"?")+c)}moqui.loadComponent(a,function(a){a.mounted=function(){var a=
$(b.$el);a.find(":not(.noResetSelect2)\x3eselect:not(.noResetSelect2)").select2({});var c=a.find(".default-focus");c.length?c.focus():a.find("form :input:visible:first").focus()};b.curComponent=a},this.id)}else this.curComponent=moqui.EmptyComponent}},mounted:function(){this.$root.addContainer(this.id,this);var a=$(this.$el),b=this;a.on("show.bs.modal",function(){b.curUrl=b.url});a.on("hidden.bs.modal",function(){b.isHidden=!0;b.curUrl=""});a.on("shown.bs.modal",function(){b.isHidden=!1});this.openDialog&&
a.modal("show")}});
Vue.component("tree-top",{template:'\x3cul :id\x3d"id" class\x3d"tree-list"\x3e\x3ctree-item v-for\x3d"model in itemList" :key\x3d"model.id" :model\x3d"model" :top\x3d"top"/\x3e\x3c/ul\x3e',props:{id:{type:String,required:!0},items:{type:[String,Array],required:!0},openPath:String,parameters:Object},data:function(){return{urlItems:null,currentPath:null,top:this}},computed:{itemList:function(){return this.urlItems?this.urlItems:moqui.isArray(this.items)?this.items:[]}},methods:{},mounted:function(){if(moqui.isString(this.items)){this.currentPath=
this.openPath;var a=$.extend({moquiSessionToken:this.$root.moquiSessionToken,treeNodeId:"#",treeOpenPath:this.openPath},this.parameters),b=this;$.ajax({type:"POST",dataType:"json",url:this.items,headers:{Accept:"application/json"},data:a,error:moqui.handleAjaxError,success:function(a){b.urlItems=a}})}}});
Vue.component("tree-item",{template:'\x3cli :id\x3d"model.id"\x3e\x3ci v-if\x3d"isFolder" @click\x3d"toggle" class\x3d"fa" :class\x3d"{\'fa-chevron-right\':!open, \'fa-chevron-down\':open}"\x3e\x3c/i\x3e\x3ci v-else class\x3d"fa fa-square-o"\x3e\x3c/i\x3e \x3cspan @click\x3d"setSelected"\x3e\x3cm-link v-if\x3d"model.a_attr" :href\x3d"model.a_attr.urlText" :load-id\x3d"model.a_attr.loadId" :class\x3d"{\'text-success\':selected}"\x3e{{model.text}}\x3c/m-link\x3e\x3cspan v-if\x3d"!model.a_attr" :class\x3d"{\'text-success\':selected}"\x3e{{model.text}}\x3c/span\x3e\x3c/span\x3e\x3cul v-show\x3d"open" v-if\x3d"hasChildren"\x3e\x3ctree-item v-for\x3d"model in model.children" :key\x3d"model.id" :model\x3d"model" :top\x3d"top"/\x3e\x3c/ul\x3e\x3c/li\x3e',props:{model:Object,
top:Object},data:function(){return{open:!1}},computed:{isFolder:function(){var a=this.model.children;return a?moqui.isArray(a)?0<a.length:!0:!1},hasChildren:function(){var a=this.model.children;return moqui.isArray(a)&&0<a.length},selected:function(){return this.top.currentPath===this.model.id}},watch:{open:function(a){if(a){var b=this.model.children;a=this.top.items;if(this.open&&b&&moqui.isBoolean(b)&&moqui.isString(a)){var b=this.model.li_attr,b=$.extend({moquiSessionToken:this.$root.moquiSessionToken,
treeNodeId:this.model.id,treeNodeName:b&&b.treeNodeName?b.treeNodeName:"",treeOpenPath:this.top.currentPath},this.top.parameters),c=this;$.ajax({type:"POST",dataType:"json",url:a,headers:{Accept:"application/json"},data:b,error:moqui.handleAjaxError,success:function(a){c.model.children=a}})}}}},methods:{toggle:function(){this.isFolder&&(this.open=!this.open)},setSelected:function(){this.top.currentPath=this.model.id;this.open=!0}},mounted:function(){this.model.state&&this.model.state.opened&&(this.open=
!0)}});
Vue.component("m-editable",{props:{id:{type:String,required:!0},labelType:{type:String,"default":"span"},labelValue:{type:String,required:!0},url:{type:String,required:!0},urlParameters:{type:Object,"default":{}},parameterName:{type:String,"default":"value"},widgetType:{type:String,"default":"textarea"},loadUrl:String,loadParameters:Object,indicator:{type:String,"default":"Saving"},tooltip:{type:String,"default":"Click to edit"},cancel:{type:String,"default":"Cancel"},submit:{type:String,"default":"Save"}},mounted:function(){var a=
$.extend({moquiSessionToken:this.$root.moquiSessionToken,parameterName:this.parameterName},this.urlParameters),a={indicator:this.indicator,tooltip:this.tooltip,cancel:this.cancel,submit:this.submit,name:this.parameterName,type:this.widgetType,cssclass:"editable-form",submitdata:a};if(this.loadUrl&&0<this.loadUrl.length){var b=this;a.loadurl=this.loadUrl;a.loadtype="POST";a.loaddata=function(a){return $.extend({currentValue:a,moquiSessionToken:b.$root.moquiSessionToken},b.loadParameters)}}$(this.$el).editable(this.url,
a)},render:function(a){return a(this.labelType,{attrs:{id:this.id,"class":"editable-label"},domProps:{innerHTML:this.labelValue}})}});
Vue.component("m-form",{props:{action:{type:String,required:!0},method:{type:String,"default":"POST"},excludeEmptyFields:Boolean,submitMessage:String,submitReloadId:String,submitHideId:String,focusField:String,noValidate:Boolean},data:function(){return{fields:{},fieldsChanged:{},buttonClicked:null}},template:'\x3cform @submit.prevent\x3d"submitForm" autocapitalize\x3d"off" autocomplete\x3d"off"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/form\x3e',methods:{submitForm:function(){var a=$(this.$el);if(this.noValidate||
a.valid()){var b=null,c=null,d=$(this.buttonClicked||document.activeElement);d.length&&a.has(d)&&d.is('button[type\x3d"submit"], input[type\x3d"submit"], input[type\x3d"image"]')&&(d.is("[name]")&&(b=d.attr("name"),c=d.val()),d.prop("disabled",!0),setTimeout(function(){d.prop("disabled",!1)},3E3));var e=new FormData(this.$el);$.each(this.fields,function(a,b){e.append(a,b)});for(var a=[],f=e.entries()[Symbol.iterator]();;){var g=f.next();if(g.done)break;var h=g.value,g=h[0],h=h[1];!this.excludeEmptyFields||
h&&h.length||a.push(g)}for(f=0;f<a.length;f++)e["delete"](a[f]);e.append("moquiSessionToken",this.$root.moquiSessionToken);b&&e.append(b,c);this.$root.loading++;$.ajax({type:this.method,url:this.$root.appRootPath+this.action,data:e,contentType:!1,processData:!1,headers:{Accept:"application/json"},error:moqui.handleLoadError,success:this.handleResponse})}else if(!this.noValidate){var k=a.find("div.has-error input, div.has-error select, div.has-error textarea").first();k.length&&(b=k.parents("div.panel-collapse.collapse").last(),
b.length?b.hasClass("in")?k.focus():(b=b.prevAll("div.panel-heading").last(),b.length?(c=b.find('a[data-toggle\x3d"collapse"]').first(),c.length?c.click():b.click(),setTimeout(function(){k.focus()},250)):k.focus()):k.focus())}},handleResponse:function(a){this.$root.loading--;var b=!1;a&&moqui.isPlainObject(a)?(b=moqui.notifyMessages(a.messageInfos,a.errors),a.screenUrl&&0<a.screenUrl.length?this.$root.setUrl(a.screenUrl):a.redirectUrl&&0<a.redirectUrl.length&&(window.location.href=a.redirectUrl)):
console.warn("m-form no response or non-JSON response: "+JSON.stringify(a));(a=this.submitHideId)&&0<a.length&&$("#"+a).modal("hide");(a=this.submitReloadId)&&0<a.length&&this.$root.reloadContainer(a);(a=this.submitMessage)&&a.length?(b=eval('"'+a+'"'),$.notify(new moqui.NotifyOptions(b,null,"success",null),moqui.notifyOpts),moqui.webrootVue.addNotify(b,"success")):b||$.notify(new moqui.NotifyOptions("Submit successful",null,"success",null),moqui.notifyOpts)},fieldChange:function(a){a=a.delegateTarget;
var b=$(a);b.hasClass("input-group")&&b.children("input").length&&(b=b.children("input").first(),a=b.get(0));var c=!1;if("INPUT"===a.nodeName||"TEXTAREA"===a.nodeName)c="radio"===b.attr("type")||"checkbox"===b.attr("type")?a.checked!==a.defaultChecked:a.value!==a.defaultValue;else if("SELECT"===a.nodeName)if(a.multiple)for(var d=a.options.length,e=0;e<d;e++){var f=a.options[e];if(f.selected!==f.defaultSelected){c=!0;break}}else c=!a.options[a.selectedIndex].defaultSelected;c?(this.fieldsChanged[b.attr("name")]=
!0,b.parents(".form-group").children("label").addClass("is-changed"),b.parents(".form-group").find(".select2-selection").addClass("is-changed"),b.addClass("is-changed")):(this.fieldsChanged[b.attr("name")]=!1,b.parents(".form-group").children("label").removeClass("is-changed"),b.parents(".form-group").find(".select2-selection").removeClass("is-changed"),b.removeClass("is-changed"))}},mounted:function(){var a=this,b=$(this.$el);this.noValidate||b.validate({errorClass:"help-block",errorElement:"span",
highlight:function(a,b,e){$(a).parents(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(a,b,e){$(a).parents(".form-group").removeClass("has-error").addClass("has-success")}});b.find('[data-toggle\x3d"tooltip"]').tooltip({placement:"auto top"});this.focusField&&0<this.focusField.length&&b.find('[name^\x3d"'+this.focusField+'"]').addClass("default-focus").focus();b.find(":input").on("change",this.fieldChange);b.find("div.input-group.date").on("change",this.fieldChange);
b.find('button[type\x3d"submit"], input[type\x3d"submit"], input[type\x3d"image"]').on("click",function(){a.buttonClicked=this})}});
Vue.component("form-link",{props:{action:{type:String,required:!0},focusField:String,noValidate:Boolean,bodyParameterNames:Array},data:function(){return{fields:{}}},template:'\x3cform @submit.prevent\x3d"submitForm" autocapitalize\x3d"off" autocomplete\x3d"off"\x3e\x3cslot :clearForm\x3d"clearForm"\x3e\x3c/slot\x3e\x3c/form\x3e',methods:{submitForm:function(){var a=$(this.$el);if(this.noValidate||a.valid()){var b=null,c=null,d=$(document.activeElement);d.length&&a.has(d)&&d.is('button[type\x3d"submit"], input[type\x3d"submit"], input[type\x3d"image"]')&&
(d.is("[name]")&&(b=d.attr("name"),c=d.val()),d.prop("disabled",!0),setTimeout(function(){d.prop("disabled",!1)},3E3));var e=a.serializeArray();$.each(this.fields,function(a,b){e.push({name:a,value:b})});for(var f=[],g=[],a="",h=null,k=0;k<e.length;k++){var l=e[k],n=l.name,m=l.value;0===m.trim().length||"moquiSessionToken"===n||"moquiFormName"===n||0<n.indexOf("[]")||(0<n.indexOf("_op")||0<n.indexOf("_not")||0<n.indexOf("_ic")?f.push(l):(g.push(n),this.bodyParameterNames&&0<=this.bodyParameterNames.indexOf(n)?
(h||(h={}),h[n]=m):(0<a.length&&(a+="\x26"),a+=encodeURIComponent(n)+"\x3d"+encodeURIComponent(m))))}for(k=0;k<f.length;k++)l=f[k],n=l.name.substring(0,l.name.indexOf("_")),0<=g.indexOf(n)&&(0<a.length&&(a+="\x26"),a+=encodeURIComponent(l.name)+"\x3d"+encodeURIComponent(l.value));b&&c&&c.trim().length&&(0<a.length&&(a+="\x26"),a+=encodeURIComponent(b)+"\x3d"+encodeURIComponent(c));b=this.action;b=0<b.indexOf("?")?b+"\x26"+a:b+"?"+a;this.$root.setUrl(b,h)}},clearForm:function(){var a=$(this.$el);a.find(":radio, :checkbox").removeAttr("checked");
a.find("textarea, :text, select").val("").trigger("change")}},mounted:function(){var a=$(this.$el);this.noValidate||a.validate({errorClass:"help-block",errorElement:"span",highlight:function(a,c,d){$(a).parents(".form-group").removeClass("has-success").addClass("has-error")},unhighlight:function(a,c,d){$(a).parents(".form-group").removeClass("has-error").addClass("has-success")}});a.find('[data-toggle\x3d"tooltip"]').tooltip({placement:"auto top"});this.focusField&&0<this.focusField.length&&a.find("[name\x3d"+
this.focusField+"]").addClass("default-focus").focus()}});
Vue.component("form-paginate",{props:{paginate:Object,formList:Object},template:'\x3cul v-if\x3d"paginate" class\x3d"pagination"\x3e\x3ctemplate v-if\x3d"paginate.pageIndex \x3e 0"\x3e\x3cli\x3e\x3ca href\x3d"#" @click.prevent\x3d"setIndex(0)"\x3e\x3ci class\x3d"fa fa-fast-backward"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" @click.prevent\x3d"setIndex(paginate.pageIndex-1)"\x3e\x3ci class\x3d"fa fa-backward"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3c/template\x3e\x3ctemplate v-else\x3e\x3cli\x3e\x3cspan\x3e\x3ci class\x3d"fa fa-fast-backward"\x3e\x3c/i\x3e\x3c/span\x3e\x3c/li\x3e\x3cli\x3e\x3cspan\x3e\x3ci class\x3d"fa fa-backward"\x3e\x3c/i\x3e\x3c/span\x3e\x3c/li\x3e\x3c/template\x3e\x3cli v-for\x3d"prevIndex in prevArray"\x3e\x3ca href\x3d"#" @click.prevent\x3d"setIndex(prevIndex)"\x3e{{prevIndex+1}}\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3cspan\x3ePage {{paginate.pageIndex+1}} of {{paginate.pageMaxIndex+1}} ({{paginate.pageRangeLow}} - {{paginate.pageRangeHigh}} of {{paginate.count}})\x3c/span\x3e\x3c/li\x3e\x3cli v-for\x3d"nextIndex in nextArray"\x3e\x3ca href\x3d"#" @click.prevent\x3d"setIndex(nextIndex)"\x3e{{nextIndex+1}}\x3c/a\x3e\x3c/li\x3e\x3ctemplate v-if\x3d"paginate.pageIndex \x3c paginate.pageMaxIndex"\x3e\x3cli\x3e\x3ca href\x3d"#" @click.prevent\x3d"setIndex(paginate.pageIndex+1)"\x3e\x3ci class\x3d"fa fa-forward"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3cli\x3e\x3ca href\x3d"#" @click.prevent\x3d"setIndex(paginate.pageMaxIndex)"\x3e\x3ci class\x3d"fa fa-fast-forward"\x3e\x3c/i\x3e\x3c/a\x3e\x3c/li\x3e\x3c/template\x3e\x3ctemplate v-else\x3e\x3cli\x3e\x3cspan\x3e\x3ci class\x3d"fa fa-forward"\x3e\x3c/i\x3e\x3c/span\x3e\x3c/li\x3e\x3cli\x3e\x3cspan\x3e\x3ci class\x3d"fa fa-fast-forward"\x3e\x3c/i\x3e\x3c/span\x3e\x3c/li\x3e\x3c/template\x3e\x3c/ul\x3e',computed:{prevArray:function(){var a=
this.paginate,b=[];if(!a||1>a.pageIndex)return b;var c=a.pageIndex,a=c-3;0>a&&(a=0);for(--c;a<=c;)b.push(a++);return b},nextArray:function(){var a=this.paginate,b=[];if(!a||a.pageIndex>=a.pageMaxIndex)return b;var c=a.pageIndex,a=a.pageMaxIndex,d=c+1,c=c+3;for(c>a&&(c=a);d<=c;)b.push(d++);return b}},methods:{setIndex:function(a){this.formList?this.formList.setPageIndex(a):this.$root.setParameters({pageIndex:a})}}});
Vue.component("form-go-page",{props:{idVal:{type:String,required:!0},maxIndex:Number,formList:Object},template:'\x3cform v-if\x3d"!formList || (formList.paginate \x26\x26 formList.paginate.pageMaxIndex \x3e 4)" @submit.prevent\x3d"goPage" class\x3d"form-inline" :id\x3d"idVal+\'_GoPage\'"\x3e\x3cdiv class\x3d"form-group"\x3e\x3clabel class\x3d"sr-only" :for\x3d"idVal+\'_GoPage_pageIndex\'"\x3ePage Number\x3c/label\x3e\x3cinput type\x3d"text" class\x3d"form-control" size\x3d"6" name\x3d"pageIndex" :id\x3d"idVal+\'_GoPage_pageIndex\'" placeholder\x3d"Page #"\x3e\x3c/div\x3e\x3cbutton type\x3d"submit" class\x3d"btn btn-default"\x3eGo\x3c/button\x3e\x3c/form\x3e',
methods:{goPage:function(){var a=this.formList,b=$("#"+this.idVal+"_GoPage_pageIndex"),c=b.val()-1;0>c||a&&c>a.paginate.pageMaxIndex||this.maxIndex&&c>this.maxIndex?b.parents(".form-group").addClass("has-error"):(b.parents(".form-group").removeClass("has-error"),a?a.setPageIndex(c):this.$root.setParameters({pageIndex:c}),b.val(""))}}});
Vue.component("form-list",{props:{name:{type:String,required:!0},id:String,rows:{type:[String,Array],required:!0},search:{type:Object},action:String,multi:Boolean,skipForm:Boolean,skipHeader:Boolean,headerForm:Boolean,headerDialog:Boolean,savedFinds:Boolean,selectColumns:Boolean,allButton:Boolean,csvButton:Boolean,textButton:Boolean,pdfButton:Boolean,columns:[String,Number]},data:function(){return{rowList:[],paginate:null,searchObj:null,moqui:moqui}},template:'\x3cdiv\x3e\x3ctemplate v-if\x3d"!multi \x26\x26 !skipForm"\x3e\x3cm-form v-for\x3d"(fields, rowIndex) in rowList" :name\x3d"idVal+\'_\'+rowIndex" :id\x3d"idVal+\'_\'+rowIndex" :action\x3d"action"\x3e\x3cslot name\x3d"rowForm" :fields\x3d"fields"\x3e\x3c/slot\x3e\x3c/m-form\x3e\x3c/template\x3e\x3cm-form v-if\x3d"multi \x26\x26 !skipForm" :name\x3d"idVal" :id\x3d"idVal" :action\x3d"action"\x3e\x3cinput type\x3d"hidden" name\x3d"moquiFormName" :value\x3d"name"\x3e\x3cinput type\x3d"hidden" name\x3d"_isMulti" value\x3d"true"\x3e\x3ctemplate v-for\x3d"(fields, rowIndex) in rowList"\x3e\x3cslot name\x3d"rowForm" :fields\x3d"fields"\x3e\x3c/slot\x3e\x3c/template\x3e\x3c/m-form\x3e\x3cform-link v-if\x3d"!skipHeader \x26\x26 headerForm \x26\x26 !headerDialog" :name\x3d"idVal+\'_header\'" :id\x3d"idVal+\'_header\'" :action\x3d"$root.currentLinkPath"\x3e\x3cinput v-if\x3d"searchObj \x26\x26 searchObj.orderByField" type\x3d"hidden" name\x3d"orderByField" :value\x3d"searchObj.orderByField"\x3e\x3cslot name\x3d"headerForm"  :search\x3d"searchObj"\x3e\x3c/slot\x3e\x3c/form-link\x3e\x3cdiv class\x3d"table-scroll-wrapper"\x3e\x3ctable class\x3d"table table-striped table-hover table-condensed" :id\x3d"idVal+\'_table\'"\x3e\x3cthead\x3e\x3ctr class\x3d"form-list-nav-row"\x3e\x3cth :colspan\x3d"columns?columns:\'100\'"\x3e\x3cnav class\x3d"form-list-nav"\x3e\x3cbutton v-if\x3d"savedFinds || headerDialog" :id\x3d"idVal+\'_hdialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_hdialog\'" data-original-title\x3d"Find Options" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e Find Options\x3c/button\x3e\x3cbutton v-if\x3d"selectColumns" :id\x3d"idVal+\'_SelColsDialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_SelColsDialog\'" data-original-title\x3d"Columns" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e Columns\x3c/button\x3e\x3cform-paginate :paginate\x3d"paginate" :form-list\x3d"this"\x3e\x3c/form-paginate\x3e\x3cform-go-page :id-val\x3d"idVal" :form-list\x3d"this"\x3e\x3c/form-go-page\x3e\x3ca v-if\x3d"csvButton" :href\x3d"csvUrl" class\x3d"btn btn-default"\x3eCSV\x3c/a\x3e\x3cbutton v-if\x3d"textButton" :id\x3d"idVal+\'_TextDialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_TextDialog\'" data-original-title\x3d"Text" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e Text\x3c/button\x3e\x3cbutton v-if\x3d"pdfButton" :id\x3d"idVal+\'_PdfDialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_PdfDialog\'" data-original-title\x3d"PDF" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e PDF\x3c/button\x3e\x3cslot name\x3d"nav"\x3e\x3c/slot\x3e\x3c/nav\x3e\x3c/th\x3e\x3c/tr\x3e\x3cslot name\x3d"header" :search\x3d"searchObj"\x3e\x3c/slot\x3e\x3c/thead\x3e\x3ctbody\x3e\x3ctr v-for\x3d"(fields, rowIndex) in rowList"\x3e\x3cslot name\x3d"row" :fields\x3d"fields" :row-index\x3d"rowIndex" :moqui\x3d"moqui"\x3e\x3c/slot\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',
computed:{idVal:function(){return this.id&&0<this.id.length?this.id:this.name},csvUrl:function(){return this.$root.currentPath+"?"+moqui.objToSearch($.extend({},this.searchObj,{renderMode:"csv",pageNoLimit:"true",lastStandalone:"true",saveFilename:this.name+".csv"}))}},methods:{fetchRows:function(){if(moqui.isArray(this.rows))console.warn("Tried to fetch form-list-body rows but rows prop is an array");else{var a=this,b=this.search;b||(b=this.$root.currentParameters);var c=this.rows;-1===c.indexOf("/")&&
(c=this.$root.currentPath+"/actions/"+c);console.info("Fetching rows with url "+c+" searchObj "+JSON.stringify(b));$.ajax({type:"GET",url:c,data:b,dataType:"json",headers:{Accept:"application/json"},error:moqui.handleAjaxError,success:function(b,c,f){b&&moqui.isArray(b)&&(c=f.getResponseHeader,(f=Number(c("X-Total-Count")))&&!isNaN(f)&&(a.paginate={count:Number(f),pageIndex:Number(c("X-Page-Index")),pageSize:Number(c("X-Page-Size")),pageMaxIndex:Number(c("X-Page-Max-Index")),pageRangeLow:Number(c("X-Page-Range-Low")),
pageRangeHigh:Number(c("X-Page-Range-High"))}),a.rowList=b,console.info("Fetched "+b.length+" rows, paginate: "+JSON.stringify(a.paginate)))}})}},setPageIndex:function(a){this.searchObj?this.searchObj.pageIndex=a:this.searchObj={pageIndex:a};this.fetchRows()}},watch:{rows:function(a){moqui.isArray(a)?this.rowList=a:this.fetchRows()},search:function(){this.fetchRows()}},mounted:function(){this.searchObj=this.search?this.search:this.$root.currentParameters;moqui.isArray(this.rows)?this.rowList=this.rows:
this.fetchRows()}});
Vue.component("date-time",{props:{id:String,name:{type:String,required:!0},value:String,type:{type:String,"default":"date-time"},size:String,format:String,tooltip:String,form:String,required:String,autoYear:String,minuteStep:{type:Number,"default":5}},template:'\x3cdiv v-if\x3d"type\x3d\x3d\'time\'" class\x3d"input-group time" :id\x3d"id"\x3e\x3cinput type\x3d"text" class\x3d"form-control" :pattern\x3d"timePattern" :id\x3d"id?(id+\'_itime\'):\'\'" :name\x3d"name" :value\x3d"value" :size\x3d"sizeVal" :form\x3d"form"\x3e\x3cspan class\x3d"input-group-addon"\x3e\x3cspan class\x3d"fa fa-clock-o"\x3e\x3c/span\x3e\x3c/span\x3e\x3c/div\x3e\x3cdiv v-else class\x3d"input-group date" :id\x3d"id"\x3e\x3cinput ref\x3d"dateInput" @focus\x3d"focusDate" @blur\x3d"blurDate" type\x3d"text" class\x3d"form-control" :id\x3d"id?(id+\'_idate\'):\'\'" :name\x3d"name" :value\x3d"value" :size\x3d"sizeVal" :form\x3d"form" :required\x3d"required \x3d\x3d \'required\' ? true : false"\x3e\x3cspan class\x3d"input-group-addon"\x3e\x3cspan class\x3d"fa fa-calendar"\x3e\x3c/span\x3e\x3c/span\x3e\x3c/div\x3e',methods:{focusDate:function(){if("time"!==
this.type&&"false"!==this.autoYear){var a=$(this.$refs.dateInput),b=a.val();b&&b.length||(b=this.autoYear&&this.autoYear.match(/^[12]\d\d\d$/)?this.autoYear:(new Date).getFullYear(),a.val(b))}},blurDate:function(){if("time"!==this.type){var a=$(this.$refs.dateInput),b=a.val();0<b.indexOf("d")?(a.val(""),a.trigger("change")):0<b.indexOf("hh:mm")?(a.val(b.replace("hh:mm","12:00")),a.trigger("change")):0<b.indexOf(":mm")&&(a.val(b.replace(":mm",":00")),a.trigger("change"))}}},computed:{formatVal:function(){var a=
this.format;return a&&0<a.length?a:"time"===this.type?"HH:mm":"date"===this.type?"YYYY-MM-DD":"YYYY-MM-DD HH:mm"},extraFormatsVal:function(){return"time"===this.type?["LT","LTS","HH:mm"]:"date"===this.type?["l","L","YYYY-MM-DD"]:["YYYY-MM-DD HH:mm","YYYY-MM-DD HH:mm:ss","MM/DD/YYYY HH:mm"]},sizeVal:function(){var a=this.size;return a&&0<a.length?a:"time"===this.type?"9":"date"===this.type?"10":"16"},timePattern:function(){return"^(?:(?:([01]?\\d|2[0-3]):)?([0-5]?\\d):)?([0-5]?\\d)$"}},mounted:function(){var a=
this,b=this.value,c=this.formatVal,d=$(this.$el);"time"===this.type?d.datetimepicker({toolbarPlacement:"top",debug:!1,showClose:!0,showClear:!0,showTodayButton:!0,useStrict:!0,defaultDate:b&&b.length?moment(b,this.formatVal):null,format:c,extraFormats:this.extraFormatsVal,stepping:this.minuteStep,locale:this.$root.locale,keyBinds:{up:function(){this.date()&&this.date(this.date().clone().add(1,"H"))},down:function(){this.date()&&this.date(this.date().clone().subtract(1,"H"))},"control up":null,"control down":null,
"shift up":function(){this.date()&&this.date(this.date().clone().add(this.stepping(),"m"))},"shift down":function(){this.date()&&this.date(this.date().clone().subtract(this.stepping(),"m"))}}}):d.datetimepicker({toolbarPlacement:"top",debug:!1,showClose:!0,showClear:!0,showTodayButton:!0,useStrict:!0,defaultDate:b&&b.length?moment(b,this.formatVal):null,format:c,extraFormats:this.extraFormatsVal,stepping:this.minuteStep,locale:this.$root.locale,keyBinds:{up:function(){this.date()&&this.date(this.date().clone().add(1,
"d"))},down:function(){this.date()&&this.date(this.date().clone().subtract(1,"d"))},"alt up":function(){this.date()&&this.date(this.date().clone().add(1,"M"))},"alt down":function(){this.date()&&this.date(this.date().clone().subtract(1,"M"))},"control up":null,"control down":null,"shift up":function(){this.date()&&this.date(this.date().clone().add(1,"y"))},"shift down":function(){this.date()&&this.date(this.date().clone().subtract(1,"y"))}}});d.on("dp.change",function(){d.val(d.find("input").first().val());
d.trigger("change");a.$emit("input",this.value)});d.val(d.find("input").first().val());this.tooltip&&this.tooltip.length&&d.tooltip({title:this.tooltip,placement:"auto"});"YYYY-MM-DD"===c&&d.find("input").inputmask("yyyy-mm-dd",{clearIncomplete:!1,clearMaskOnLostFocus:!0,showMaskOnFocus:!0,showMaskOnHover:!1,removeMaskOnSubmit:!1});"YYYY-MM-DD HH:mm"===c&&d.find("input").inputmask("yyyy-mm-dd hh:mm",{clearIncomplete:!1,clearMaskOnLostFocus:!0,showMaskOnFocus:!0,showMaskOnHover:!1,removeMaskOnSubmit:!1})}});
moqui.dateOffsets=[{id:"0",text:"This"},{id:"-1",text:"Last"},{id:"1",text:"Next"},{id:"-2",text:"-2"},{id:"2",text:"+2"},{id:"-3",text:"-3"},{id:"-4",text:"-4"},{id:"-6",text:"-6"},{id:"-12",text:"-12"}];moqui.datePeriods=[{id:"day",text:"Day"},{id:"7d",text:"7 Days"},{id:"30d",text:"30 Days"},{id:"week",text:"Week"},{id:"weeks",text:"Weeks"},{id:"month",text:"Month"},{id:"months",text:"Months"},{id:"quarter",text:"Quarter"},{id:"year",text:"Year"},{id:"7r",text:"+/-7d"},{id:"30r",text:"+/-30d"}];
moqui.emptyOpt={id:"",text:" "};
Vue.component("date-period",{props:{name:{type:String,required:!0},id:String,allowEmpty:Boolean,offset:String,period:String,date:String,fromDate:String,thruDate:String,fromThruType:{type:String,"default":"date"},form:String},data:function(){return{fromThruMode:!1,dateOffsets:moqui.dateOffsets.slice(),datePeriods:moqui.datePeriods.slice()}},template:'\x3cdiv v-if\x3d"fromThruMode"\x3e\x3cdate-time :name\x3d"name+\'_from\'" :id\x3d"id+\'_from\'" :form\x3d"form" :type\x3d"fromThruType" :value\x3d"fromDate"/\x3e - \x3cdate-time :name\x3d"name+\'_thru\'" :id\x3d"id+\'_thru\'" :form\x3d"form" :type\x3d"fromThruType" :value\x3d"thruDate"/\x3e \x3ci @click\x3d"toggleMode" class\x3d"fa fa-arrows-v"\x3e\x3c/i\x3e\x3c/div\x3e\x3cdiv v-else class\x3d"date-period" :id\x3d"id"\x3e\x3cdrop-down :name\x3d"name+\'_poffset\'" :options\x3d"dateOffsets" :value\x3d"offset" :allow-empty\x3d"allowEmpty" :form\x3d"form"\x3e\x3c/drop-down\x3e \x3cdrop-down :name\x3d"name+\'_period\'" :options\x3d"datePeriods" :value\x3d"period" :allow-empty\x3d"allowEmpty" :form\x3d"form"\x3e\x3c/drop-down\x3e \x3cdate-time :name\x3d"name+\'_pdate\'" :id\x3d"id+\'_pdate\'" :form\x3d"form" type\x3d"date" :value\x3d"date"/\x3e \x3ci @click\x3d"toggleMode" class\x3d"fa fa-arrows-h"\x3e\x3c/i\x3e\x3c/div\x3e',methods:{toggleMode:function(){this.fromThruMode=
!this.fromThruMode}},beforeMount:function(){if(this.fromDate&&this.fromDate.length||this.thruDate&&this.thruDate.length)this.fromThruMode=!0}});
Vue.component("drop-down",{props:{options:Array,value:[Array,String],combo:Boolean,allowEmpty:Boolean,multiple:String,optionsUrl:String,serverSearch:{type:Boolean,"default":!1},serverDelay:{type:Number,"default":300},serverMinLength:{type:Number,"default":1},optionsParameters:Object,labelField:String,valueField:String,dependsOn:Object,dependsOptional:Boolean,optionsLoadInit:Boolean,form:String,tooltip:String},data:function(){return{curData:null,s2Opts:null,lastVal:null}},template:'\x3cselect :form\x3d"form" :data-title\x3d"tooltip"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/select\x3e',
methods:{processOptionList:function(a,b,c){var d=[];!this.allowEmpty||b&&!(1>=b)||c&&""!==c.trim()||d.push({id:" ",text:" "});var e=this.labelField;e||(e="label");var f=this.valueField;f||(f="value");$.each(a,function(a,b){var c=b[f];c||(c=" ");d.push({id:c,text:b[e]})});return d},serverData:function(a){var b=!0,c=this.dependsOn,d=this.optionsParameters,e={moquiSessionToken:this.$root.moquiSessionToken},f;for(f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);for(var g in c)c.hasOwnProperty(g)&&((d=$("#"+c[g]).val())&&
" "!==d?e[g]=d:b=!1);a?(e.term=a.term||"",e.pageIndex=(a.page||1)-1):this.serverSearch&&(e.term="",e.pageIndex=0);e.hasAllParms=b;return e},processResponse:function(a,b){if(moqui.isArray(a))return{results:this.processOptionList(a,null,b.term)};b.page=b.page||1;var c=a.pageSize||20;return{results:this.processOptionList(a.options,b.page,b.term),pagination:{more:a.count?b.page*c<a.count:!1}}},populateFromUrl:function(a){if(this.optionsUrl&&0!==this.optionsUrl.length){var b=this.serverData(a);if(b.hasAllParms||
this.dependsOptional){var c=this;$.ajax({type:"POST",url:this.optionsUrl,data:b,dataType:"json",headers:{Accept:"application/json"},error:moqui.handleAjaxError,success:function(b){if(b=moqui.isArray(b)?b:b.options)c.curData=c.processOptionList(b,null,a?a.term:null)}})}else this.curData=null}}},mounted:function(){var a=$(this.$el),b=this,c={minimumResultsForSearch:10};this.combo&&(c.tags=!0,c.tokenSeparators=[","," "]);"multiple"===this.multiple&&(c.multiple=!0,c.closeOnSelect=!1,c.width="100%",a.css("min-width",
"240px"),a.addClass("noResetSelect2"));this.options&&0<this.options.length&&(c.data=this.allowEmpty&&"multiple"!==this.multiple?[{id:"",text:" "}].concat(this.options):this.options);this.serverSearch&&(this.optionsUrl||console.error("drop-down in form "+this.form+" has no options-url but has server-search\x3dtrue"),c.ajax={url:this.optionsUrl,type:"POST",dataType:"json",delay:this.serverDelay,cache:!0,data:this.serverData,processResults:this.processResponse,error:moqui.handleAjaxError},c.minimumInputLength=
this.serverMinLength,c.minimumResultsForSearch=0,c.width="100%",a.css("min-width","200px"),a.addClass("noResetSelect2"));this.s2Opts=c;a.select2(c).on("change",function(){b.$emit("input",this.value)});this.tooltip&&this.tooltip.length&&a.next().tooltip({title:function(){return $(this).prev().attr("data-title")},placement:"auto"});var d=this.value;d&&d.length&&(this.curVal=d);if(this.optionsUrl&&0<this.optionsUrl.length){var a=this.dependsOn,e;for(e in a)if(a.hasOwnProperty(e))$("#"+a[e]).on("change",
function(){b.populateFromUrl({term:d})});this.optionsLoadInit&&(this.serverSearch?d&&d.length&&moqui.isString(d)&&this.populateFromUrl({term:d}):this.populateFromUrl())}},computed:{curVal:{get:function(){return $(this.$el).select2().val()},set:function(a){$(this.$el).val(a).trigger("change")}}},watch:{value:function(a){this.curVal=a},options:function(a){this.curData=a},curData:function(a){var b=$(this.$el),c=this,d=b.next().hasClass("select2-container--focus"),e=b.select2().val();e&&1<e.length&&(this.lastVal=
e);b.select2("destroy");b.empty();this.s2Opts.data=a;b.select2(this.s2Opts).on("change",function(){c.$emit("input",this.value)});this.tooltip&&this.tooltip.length&&b.next().tooltip({title:function(){return $(this).prev().attr("data-title")},placement:"auto"});d&&b.focus();setTimeout(function(){var d=c.lastVal;if(!d||2>d.length)d=c.value;if(d){var e=!1,h=moqui.isArray(d);$.each(a,function(a,b){if(h?d.includes(b.id):b.id===d)e=!0});e&&b.val(d)}b.trigger("change")},50)}},destroyed:function(){$(this.$el).off().select2("destroy")}});
Vue.component("text-autocomplete",{props:{id:{type:String,required:!0},name:{type:String,required:!0},value:String,valueText:String,type:String,size:String,maxlength:String,disabled:Boolean,validationClasses:String,dataVvValidation:String,required:Boolean,pattern:String,tooltip:String,form:String,delay:{type:Number,"default":300},url:{type:String,required:!0},dependsOn:Object,acParameters:Object,minLength:{type:Number,"default":1},showValue:Boolean,useActual:Boolean,skipInitial:Boolean},data:function(){return{delayTimeout:null}},
template:'\x3cspan\x3e\x3cinput ref\x3d"acinput" :id\x3d"acId" :name\x3d"acName" :type\x3d"type" :value\x3d"valueText" :size\x3d"size" :maxlength\x3d"maxlength" :disabled\x3d"disabled" :class\x3d"allClasses" :data-vv-validation\x3d"validationClasses" :required\x3d"required" :pattern\x3d"pattern" :data-toggle\x3d"tooltipToggle" :title\x3d"tooltip" autocomplete\x3d"off" :form\x3d"form"\x3e\x3cinput ref\x3d"hidden" :id\x3d"id" type\x3d"hidden" :name\x3d"name" :value\x3d"value" :form\x3d"form"\x3e\x3cspan ref\x3d"show" v-if\x3d"showValue" :id\x3d"showId" class\x3d"form-autocomplete-value"\x3e{{valueText}}\x3c/span\x3e\x3c/span\x3e',
computed:{acId:function(){return this.id+"_ac"},acName:function(){return this.name+"_ac"},allClasses:function(){return"form-control typeahead"+(this.validationClasses?" "+this.validationClasses:"")},showId:function(){return this.id+"_show"},tooltipToggle:function(){return this.tooltip&&0<this.tooltip.length?"tooltip":null}},methods:{fetchResults:function(a,b,c){this.delayTimeout&&clearTimeout(this.delayTimeout);var d=this;this.delayTimeout=setTimeout(function(){var b=d.dependsOn,f=d.acParameters,
g={term:a,moquiSessionToken:d.$root.moquiSessionToken},h;for(h in f)f.hasOwnProperty(h)&&(g[h]=f[h]);for(var k in b)b.hasOwnProperty(k)&&(f=$("#"+b[k]).val())&&(g[k]=f);$.ajax({url:d.url,type:"POST",dataType:"json",data:g,error:moqui.handleAjaxError,success:function(a){a=moqui.isArray(a)?a:a.options;c($.map(a,function(a){return{label:a.label,value:a.value}}))}})},this.delay)}},mounted:function(){var a=$(this.$refs.acinput),b=$(this.$refs.hidden),c=this.$refs.show?$(this.$refs.show):null;a.typeahead({minLength:this.minLength,
highlight:!0,hint:!1},{limit:99,source:this.fetchResults,display:function(a){return a.label}});a.bind("typeahead:select",function(d,e){if(e)return this.value=e.value,b.val(e.value),b.trigger("change"),a.val(e.label),c&&e.label&&c.html(e.label),!1});a.change(function(){a.val()?this.useActual&&(b.val(a.val()),b.trigger("change")):(b.val(""),b.trigger("change"))});var d=this.dependsOn,e;for(e in d)d.hasOwnProperty(e)&&$("#"+d[e]).change(function(){b.val("");a.val("")});if(!this.skipInitial&&b.val()){var f=
this.acParameters,g={term:b.val(),moquiSessionToken:this.$root.moquiSessionToken},h;for(h in f)f.hasOwnProperty(h)&&(g[h]=f[h]);for(e in d)d.hasOwnProperty(e)&&(f=$("#"+d[e]).val())&&(g[e]=f);$.ajax({url:this.url,type:"POST",dataType:"json",data:g,error:moqui.handleAjaxError,success:function(d){d=moqui.isArray(d)?d:d.options;for(var e=b.val(),f=0;f<d.length;f++)if(d[f].value==e){a.val(d[f].label);c&&c.html(d[f].label);break}}})}}});
Vue.component("subscreens-tabs",{data:function(){return{pathIndex:-1}},template:'\x3cul v-if\x3d"subscreens.length \x3e 1" class\x3d"nav nav-tabs" role\x3d"tablist"\x3e\x3cli v-for\x3d"tab in subscreens" :class\x3d"{active:tab.active,disabled:tab.disableLink}"\x3e\x3cspan v-if\x3d"tab.disabled"\x3e{{tab.title}}\x3c/span\x3e\x3cm-link v-else :href\x3d"tab.pathWithParams"\x3e{{tab.title}}\x3c/m-link\x3e\x3c/li\x3e\x3c/ul\x3e',computed:{subscreens:function(){if(!this.pathIndex||0>this.pathIndex)return[];
var a=this.$root.navMenuList[this.pathIndex];return a&&a.subscreens?a.subscreens:[]}},mounted:function(){this.pathIndex=this.$root.activeSubscreens.length}});
Vue.component("subscreens-active",{data:function(){return{activeComponent:moqui.EmptyComponent,pathIndex:-1,pathName:null}},template:'\x3ccomponent :is\x3d"activeComponent"\x3e\x3c/component\x3e',methods:{loadActive:function(){var a=this,b=a.$root,c=a.pathIndex,d=b.currentPathList,e=d[c],f=this.pathName!==e;this.pathName=e;if(!e||0===e.length)return console.info("in subscreens-active newPath is empty, loading EmptyComponent and returning true"),this.activeComponent=moqui.EmptyComponent,!0;e=b.basePath+
"/"+d.slice(0,c+1).join("/");if(!f&&moqui.componentCache.containsKey(e))return!1;f={path:e};c===d.length-1&&(d=b.extraPathList)&&0<d.length&&(f.extraPath=d.join("/"));(d=b.currentSearch)&&0<d.length&&(f.search=d);f.bodyParameters=b.bodyParameters;(d=b.navMenuList[c+b.basePathSize])&&d.renderModes&&(f.renderModes=d.renderModes);console.info("subscreens-active loadActive pathIndex "+c+" pathName "+a.pathName+" urlInfo "+JSON.stringify(f));b.loading++;b.currentLoadRequest=moqui.loadComponent(f,function(c){b.currentLoadRequest=
null;a.activeComponent=c;b.loading--});return!0}},mounted:function(){this.$root.addSubscreen(this)}});
moqui.webrootVue=new Vue({el:"#apps-root",data:{basePath:"",linkBasePath:"",currentPathList:[],extraPathList:[],activeSubscreens:[],currentParameters:{},bodyParameters:null,navMenuList:[],navHistoryList:[],navPlugins:[],notifyHistoryList:[],lastNavTime:Date.now(),loading:0,currentLoadRequest:null,activeContainers:{},moquiSessionToken:"",appHost:"",appRootPath:"",userId:"",locale:"en",notificationClient:null,qzVue:null},methods:{setUrl:function(a,b){$(".modal.in").modal("hide");this.currentLoadRequest&&
(console.log("Aborting current page load currentLinkUrl "+this.currentLinkUrl+" url "+a),this.currentLoadRequest.abort(),this.currentLoadRequest=null,this.loading=0);this.bodyParameters=b;a=this.getLinkPath(a);if(this.currentLinkUrl===a&&a!==this.linkBasePath)this.reloadSubscreens();else{var c=a,d=c.indexOf("://");if(0<=d){d=c.indexOf("/",d+3);if(-1===d)return;c=c.slice(d)}c=c.split("?");this.extraPathList=[];this.currentSearch=1<c.length&&0<c[1].length?c[1]:"";this.currentPath=c[0];c=this.currentSearch;
if((c=this.currentPath+(0<c.length?"?"+c:""))&&0!==c.length){console.info("current URL changing to "+c);this.lastNavTime=Date.now();this.activeContainers={};var e=this,c=this.appRootPath&&this.appRootPath.length&&0===c.indexOf(this.appRootPath)?this.appRootPath+"/menuData"+c.slice(this.appRootPath.length):"/menuData"+c;$.ajax({type:"GET",url:c,dataType:"text",error:moqui.handleAjaxError,success:function(a){var b=null;try{b=JSON.parse(a)}catch(c){console.info("Error parson menu list JSON: "+c)}b&&
moqui.isArray(b)&&(e.navMenuList=b)}});window.history.pushState(null,this.ScreenTitle,a);document.documentElement.scrollTop=0;document.body.scrollTop=0}}},setParameters:function(a){a&&(this.$root.currentParameters=$.extend({},this.$root.currentParameters,a));this.$root.reloadSubscreens()},addSubscreen:function(a){a.pathIndex=this.activeSubscreens.length;a.loadActive();this.activeSubscreens.push(a)},reloadSubscreens:function(){var a=this.currentPathList,b=this.activeSubscreens;console.info("reloadSubscreens currentPathList "+
JSON.stringify(this.currentPathList));if(0===a.length&&0<b.length)b.splice(1),b[0].loadActive();else for(var c=0;c<b.length&&!(c>=a.length);c++)b[c].loadActive()&&b.splice(c+1)},goPreviousScreen:function(){for(var a=this.currentPath,b=this.navHistoryList,c,d=0;d<b.length;d++)if(0>b[d].pathWithParams.indexOf(a)){c=b[d];break}c&&c.pathWithParams&&c.pathWithParams.length&&this.setUrl(c.pathWithParams)},addContainer:function(a,b){this.activeContainers[a]=b},reloadContainer:function(a){var b=this.activeContainers[a];
b?b.reload():console.error("Container with ID "+a+" not found, not reloading")},loadContainer:function(a,b){var c=this.activeContainers[a];c?c.load(b):console.error("Container with ID "+a+" not found, not loading url "+b)},addNavPlugin:function(a){var b=this;moqui.loadComponent(this.appRootPath+a,function(a){b.navPlugins.push(a)})},addNavPluginsWait:function(a,b){if(a&&a.length>b){this.addNavPlugin(a[b]);var c=this;a.length>b+1&&setTimeout(function(){c.addNavPluginsWait(a,b+1)},500)}},addNotify:function(a,
b){var c=this.notifyHistoryList.slice(0),d=new Date,e=d.getHours();10>e&&(e="0"+e);d=d.getMinutes();10>d&&(d="0"+d);for(c.unshift({message:a,type:b,time:e+":"+d});25<c.length;)c.pop();this.notifyHistoryList=c},switchDarkLight:function(){var a=$("body");a.toggleClass("bg-dark");a.toggleClass("bg-light");a=a.hasClass("bg-dark")?"bg-dark":"bg-light";$.ajax({type:"POST",url:this.appRootPath+"/apps/setPreference",error:moqui.handleAjaxError,data:{moquiSessionToken:this.moquiSessionToken,preferenceKey:"OUTER_STYLE",
preferenceValue:a}})},showScreenDocDialog:function(a){$("#screen-document-dialog").modal("show");$("#screen-document-dialog-body").load(this.currentPath+"/screenDoc?docIndex\x3d"+a)},stopProp:function(a){a.stopPropagation()},getNavHref:function(a){a||(a=this.navMenuList.length-1);a=this.navMenuList[a];if(a.extraPathList&&a.extraPathList.length){var b=a.path+"/"+a.extraPathList.join("/"),c=a.pathWithParams.indexOf("?");0<c&&(b+=a.pathWithParams.slice(c));return b}return a.pathWithParams||a.path},getLinkPath:function(a){this.appRootPath&&
this.appRootPath.length&&0!==a.indexOf(this.appRootPath)&&(a=this.appRootPath+a);var b=a.split("/"),c=this.appRootPath?2:1;b.length>c&&(b[c]=this.linkBasePath.slice(1),a=b.join("/"));return a}},watch:{navMenuList:function(a){if(0<a.length){var b=a[a.length-1];a=1<a.length?a[a.length-2]:null;b.extraPathList&&(this.extraPathList=b.extraPathList);var c=this.basePathSize,d=b.path.split("/").slice(c+1);console.info("nav updated fullPath "+JSON.stringify(d)+" currentPathList "+JSON.stringify(this.currentPathList)+
" cur.path "+b.path+" basePathSize "+c);this.currentPathList=d;this.reloadSubscreens();a=(a?a.title+" - ":"")+b.title;var c=b.pathWithParams,e=c.indexOf("?");if(0<e){for(var d=["pageIndex","orderBySelect","orderByField","moquiSessionToken"],f=c.substring(e+1).split("\x26"),c=c.substring(0,e),e=0,g="",h=0;h<f.length;h++){var k=f[h],c=-1===c.indexOf("?")?c+"?":c+"\x26",c=c+k;if(!(3<e)){var l=k.indexOf("\x3d");if(0<l){var n=k.substring(0,l),k=k.substring(l+1);0<n.indexOf("_op")||0<n.indexOf("_not")||
0<n.indexOf("_ic")||0<d.indexOf(n)||n===k||(0<g.length&&(g+=", "),g+=decodeURIComponent(k),e++)}}}0<g.length&&(70<g.length&&(g=g.substring(0,70)+"..."),a=a+" ("+g+")")}d=this.navHistoryList;for(f=0;f<d.length;)d[f].pathWithParams===c?d.splice(f,1):f++;for(d.unshift({title:a,pathWithParams:c,image:b.image,imageType:b.imageType});25<d.length;)d.pop();document.title=a}},currentPathList:function(a){(a=a[a.length-1])&&$(this.$el).removeClass().addClass(a)}},computed:{currentPath:{get:function(){var a=
this.currentPathList,b=this.extraPathList;return this.basePath+(a&&0<a.length?"/"+a.join("/"):"")+(b&&0<b.length?"/"+b.join("/"):"")},set:function(a){a&&0!==a.length?("/"===a.slice(a.length-1)&&(a=a.slice(0,a.length-1)),0===a.indexOf(this.linkBasePath)?a=a.slice(this.linkBasePath.length+1):0===a.indexOf(this.basePath)&&(a=a.slice(this.basePath.length+1)),this.currentPathList=a.split("/")):this.currentPathList=[]}},currentLinkPath:function(){var a=this.currentPathList,b=this.extraPathList;return this.linkBasePath+
(a&&0<a.length?"/"+a.join("/"):"")+(b&&0<b.length?"/"+b.join("/"):"")},currentSearch:{get:function(){return moqui.objToSearch(this.currentParameters)},set:function(a){this.currentParameters=moqui.searchToObj(a)}},currentLinkUrl:function(){var a=this.currentSearch;return this.currentLinkPath+(0<a.length?"?"+a:"")},basePathSize:function(){return this.basePath.split("/").length-this.appRootPath.split("/").length},ScreenTitle:function(){return 0<this.navMenuList.length?this.navMenuList[this.navMenuList.length-
1].title:""},documentMenuList:function(){for(var a=[],b=0;b<this.navMenuList.length;b++){var c=this.navMenuList[b].screenDocList;c&&c.length&&c.forEach(function(b){a.push(b)})}return a}},created:function(){this.moquiSessionToken=$("#confMoquiSessionToken").val();this.appHost=$("#confAppHost").val();this.appRootPath=$("#confAppRootPath").val();this.basePath=$("#confBasePath").val();this.linkBasePath=$("#confLinkBasePath").val();this.userId=$("#confUserId").val();this.locale=$("#confLocale").val();
moqui.localeMap[this.locale]&&(this.locale=moqui.localeMap[this.locale]);var a=$("#confOuterStyle").val();if(a){var b=$("body"),c=b.hasClass("bg-dark")?"bg-dark":"bg-light";c!==a&&(b.removeClass(c),b.addClass(a))}this.notificationClient=new moqui.NotificationClient(("https:"===location.protocol?"wss://":"ws://")+this.appHost+this.appRootPath+"/notws");var d=[];$(".confNavPluginUrl").each(function(a,b){d.push($(b).val())});this.addNavPluginsWait(d,0)},mounted:function(){var a=$(this.$el);a.find('.navbar [data-toggle\x3d"tooltip"]').tooltip({placement:"bottom",
trigger:"hover"});a.find("#history-menu-link").tooltip({placement:"bottom",trigger:"hover"});a.find("#notify-history-menu-link").tooltip({placement:"bottom",trigger:"hover"});a.find("#document-menu-link").tooltip({placement:"bottom",trigger:"hover"});this.setUrl(window.location.pathname+window.location.search);this.notificationClient.registerListener("ALL");$("#screen-document-dialog").on("hidden.bs.modal",function(){var a=$("#screen-document-dialog-body");a.empty();a.append('\x3cdiv class\x3d"spinner"\x3e\x3cdiv\x3eLoading\x3c/div\x3e\x3c/div\x3e')});
window.Notification&&"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission(function(a){"granted"===a?moqui.notifyMessages("Browser notifications enabled, if you don't want them use browser notification settings to block"):"denied"===a&&moqui.notifyMessages("Browser notifications disabled, if you want them use browser notification settings to allow")})}});
window.addEventListener("popstate",function(){moqui.webrootVue.setUrl(window.location.pathname+window.location.search)});