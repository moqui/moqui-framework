Vue.prototype.moqui=moqui;Vue.prototype.moment=moment;Vue.prototype.window=window;moqui.urlExtensions={js:"qjs",vue:"qvue",vuet:"qvt"};window.define||(window.define=function(a,b,c){moqui.isString(a)||(c=b,b=a);moqui.isArray(b)||(c=b);return moqui.isFunction(c)?c():c});Vue.filter("decodeHtml",moqui.htmlDecode);Vue.filter("format",moqui.format);moqui.getQuasarColor=function(a){return"success"===a?"positive":"danger"===a?"negative":a};moqui.notifyOpts={timeout:1500,type:"positive"};
moqui.notifyOptsInfo={timeout:5E3,type:"info"};moqui.notifyOptsError={timeout:15E3,type:"negative"};
moqui.notifyMessages=function(a,b,c){var d=!1;if(a)if(moqui.isArray(a))for(var e=0;e<a.length;e++){d=a[e];if(moqui.isPlainObject(d)){var f=moqui.getQuasarColor(d.type);f&&f.length||(f="info");moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsInfo,{type:f,message:d.message}));moqui.webrootVue.addNotify(d.message,f)}else moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsInfo,{message:d})),moqui.webrootVue.addNotify(d,"info");d=!0}else moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsInfo,
{message:a})),moqui.webrootVue.addNotify(a,"info"),d=!0;if(b)if(moqui.isArray(b))for(a=0;a<b.length;a++)moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsError,{message:b[a]})),moqui.webrootVue.addNotify(b[a],"negative"),d=!0;else moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsError,{message:b})),moqui.webrootVue.addNotify(b,"negative"),d=!0;if(c)if(moqui.isArray(c))for(b=0;b<c.length;b++)moqui.notifyValidationError(c[b]),d=!0;else moqui.notifyValidationError(c),d=!0;return d};
moqui.notifyValidationError=function(a){var b=a;moqui.isPlainObject(a)&&(b=a.message,a.fieldPretty&&a.fieldPretty.length&&(b=b+" (for field "+a.fieldPretty+")"));moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsError,{message:b}));moqui.webrootVue.addNotify(b,"negative")};
moqui.handleAjaxError=function(a,b,c,d){if(!d){if("blob"===a.responseType){var e=new FileReader;e.onload=function(d){moqui.handleAjaxError(a,b,c,d.target.result)};e.readAsText(a.response);return}d=a.responseText}try{e=JSON.parse(d)}catch(g){}console.warn("ajax "+b+" ("+a.status+"), message "+c);var f=!1;401===a.status?f=moqui.notifyMessages(null,"No user authenticated"):e&&moqui.isPlainObject(e)?f=moqui.notifyMessages(e.messageInfos,e.errors,e.validationErrors):d&&moqui.isString(d)&&d.length&&(f=
moqui.notifyMessages(d));401===a.status?moqui.webrootVue?window.location.href=moqui.webrootVue.currentLinkUrl:window.location.reload(!0):0===a.status?0>c.indexOf("abort")&&(moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsError,{message:"Could not connect to server"})),moqui.webrootVue.addNotify("Could not connect to server","negative")):f||(console.log("got here 2 notified ",f),e="Error: "+c+" ("+b+")",moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsError,{message:e})),moqui.webrootVue.addNotify(e,
"negative"))};moqui.notifyGrowl=function(a){a&&(moqui.webrootVue.$q.notify($.extend({},moqui.notifyOptsInfo,{type:a.type,message:a.title})),moqui.webrootVue.addNotify(a.title,a.type))};moqui.componentCache=new moqui.LruMap(50);moqui.handleLoadError=function(a,b,c){"abort"===b?console.warn("load aborted: "+b+" ("+a.status+"), message "+c):(moqui.webrootVue.loading=0,moqui.handleAjaxError(a,b,c))};
moqui.loadComponent=function(a,b,c){var d=moqui.urlExtensions.js,e=moqui.urlExtensions.vue,f=moqui.urlExtensions.vuet,g,m,k,h;if("string"===typeof a){var l=a.indexOf("?");0<l?(g=a.slice(0,l),k=a.slice(l+1)):g=a}else g=a.path,m=a.extraPath,k=a.search,h=a.bodyParameters;console.log("Load Component "+JSON.stringify(a)+" Window Width "+window.innerWidth+" Quasar Platform: "+JSON.stringify(Quasar.Platform.is)+" search: "+k);!(600>=window.innerWidth||Quasar.Platform.is.mobile)||k&&-1!==k.indexOf("_uiType")||
(k=(k||"")+"\x26_uiType\x3dmobile");if(l=moqui.componentCache.get(g))console.info("found cached component for path "+g+": "+JSON.stringify(l)),b(l);else{var n=g;a.renderModes&&0<=a.renderModes.indexOf(e)&&(n+="."+e);if(n.slice(-e.length)===e)return console.info("loadComponent vue "+n+(c?" id "+c:"")),a={type:"GET",url:n,error:moqui.handleLoadError,success:function(a,c,d){205===d.status?(a=d.getResponseHeader("X-Redirect-To"),moqui.webrootVue.setUrl(a)):(a||b(moqui.NotFound),c=0<=d.getResponseHeader("Cache-Control").indexOf("max-age"),
moqui.isString(a)&&0<a.length?(a=httpVueLoader.parse(a,n.substr(0,n.lastIndexOf("/")+1)),c&&moqui.componentCache.put(g,a),b(a)):b(moqui.NotFound))}},h&&!$.isEmptyObject(h)&&(a.type="POST",a.data=h),$.ajax(a);var p=g.slice(-d.length)===d;!p&&a.renderModes&&0<=a.renderModes.indexOf(d)&&(n+="."+d,p=!0);p||(n+="."+f);m&&0<m.length&&(n+="/"+m);k&&0<k.length&&(n+="?"+k);console.info("loadComponent "+n+(c?" id "+c:""));a={type:"GET",url:n,error:moqui.handleLoadError,success:function(a,e,h){if(205===h.status)a=
h.getResponseHeader("X-Redirect-To"),moqui.webrootVue.setUrl(a);else{a||b(moqui.NotFound);var k=(e=h.getResponseHeader("Cache-Control"))&&0<=e.indexOf("max-age");if(moqui.isString(a)&&0<a.length)if(p||"define("===a.slice(0,7)){console.info("loaded JS from "+n+(c?" id "+c:""));var l=eval(a);l.template?(k&&moqui.componentCache.put(g,l),b(l)):(a=(g.slice(-d.length)===d?g.slice(0,-d.length):g)+"."+f,$.ajax({type:"GET",url:a,error:moqui.handleLoadError,success:function(a){l.template=a;k&&moqui.componentCache.put(g,
l);b(l)}}))}else a=a.replace(/<script/g,"\x3cm-script").replace(/<\/script>/g,"\x3c/m-script\x3e").replace(/<link/g,"\x3cm-stylesheet"),console.info("loaded HTML template from "+n+(c?" id "+c:"")),a={template:"\x3cdiv"+(c&&0<c.length?' id\x3d"'+c+'"':"")+"\x3e"+a+"\x3c/div\x3e"},k&&moqui.componentCache.put(g,a),b(a);else moqui.isPlainObject(a)?a.screenUrl&&a.screenUrl.length?moqui.webrootVue.setUrl(a.screenUrl):a.redirectUrl&&a.redirectUrl.length&&window.location.replace(a.redirectUrl):b(moqui.NotFound)}}};
h&&!$.isEmptyObject(h)&&(a.type="POST",a.data=h);return $.ajax(a)}};moqui.NotFound=Vue.extend({template:'\x3cdiv id\x3d"current-page-root"\x3e\x3ch4\x3eScreen not found at {{this.$root.currentPath}}\x3c/h4\x3e\x3c/div\x3e'});moqui.EmptyComponent=Vue.extend({template:'\x3cdiv id\x3d"current-page-root"\x3e\x3cdiv class\x3d"spinner"\x3e\x3cdiv\x3e\x26nbsp;\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e'});
Vue.component("m-link",{props:{href:{type:String,required:!0},loadId:String,confirmation:String},template:'\x3ca :href\x3d"linkHref" @click.prevent\x3d"go" class\x3d"q-link"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/a\x3e',methods:{go:function(a){0!==a.button||this.confirmation&&this.confirmation.length&&!window.confirm(this.confirmation)||(this.loadId&&0<this.loadId.length?this.$root.loadContainer(this.loadId,this.href):a.ctrlKey||a.metaKey?window.open(this.linkHref,"_blank"):this.$root.setUrl(this.linkHref))}},
computed:{linkHref:function(){return this.$root.getLinkPath(this.href)}}});
Vue.component("router-link",{props:{to:{type:String,required:!0}},template:'\x3ca :href\x3d"linkHref" @click.prevent\x3d"go"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/a\x3e',methods:{go:function(a){0===a.button&&(a.ctrlKey||a.metaKey?window.open(this.linkHref,"_blank"):this.$root.setUrl(this.linkHref))}},computed:{linkHref:function(){return this.$root.getLinkPath(this.to)},isActive:function(){var a=this.to,b=a.indexOf("?");0<b&&(a=a.slice(0,b));b=this.$root.currentPath;console.warn("router-link path ["+a+
"] active path ["+b+"]");return b.startsWith(a)},isExactActive:function(){return this.isActive}}});Vue.component("m-script",{props:{src:String,type:{type:String,"default":"text/javascript"}},template:'\x3cdiv :type\x3d"type" style\x3d"display:none;"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/div\x3e',created:function(){this.src&&0<this.src.length&&moqui.loadScript(this.src)},mounted:function(){var a=this.$el.innerText;a&&0<a.trim().length&&moqui.retryInlineScript(a,1)}});
Vue.component("m-stylesheet",{name:"mStylesheet",props:{href:{type:String,required:!0},rel:{type:String,"default":"stylesheet"},type:{type:String,"default":"text/css"}},template:'\x3cdiv :type\x3d"type" style\x3d"display:none;"\x3e\x3c/div\x3e',created:function(){moqui.loadStylesheet(this.href,this.rel,this.type)}});
Vue.component("m-container-box",{name:"mContainerBox",props:{type:{type:String,"default":"default"},title:String,initialOpen:{type:Boolean,"default":!0}},data:function(){return{isBodyOpen:this.initialOpen}},template:'\x3cq-card flat bordered class\x3d"q-ma-sm m-container-box"\x3e\x3cq-card-actions @click.self\x3d"toggleBody"\x3e\x3ch5 v-if\x3d"title \x26\x26 title.length" @click\x3d"toggleBody" :class\x3d"\'text-\' + type"\x3e{{title}}\x3c/h5\x3e\x3cslot name\x3d"header"\x3e\x3c/slot\x3e\x3cq-space\x3e\x3c/q-space\x3e\x3cslot name\x3d"toolbar"\x3e\x3c/slot\x3e\x3c/q-card-actions\x3e\x3cq-card-section :class\x3d"{in:isBodyOpen}"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/q-card-section\x3e\x3c/q-card\x3e',
methods:{toggleBody:function(){this.isBodyOpen=!this.isBodyOpen}}});Vue.component("m-box-body",{name:"mBoxBody",props:{height:String},data:function(){return this.height?{dialogStyle:{"max-height":this.height+"px","overflow-y":"auto"}}:{dialogStyle:{}}},template:'\x3cdiv class\x3d"q-pa-xs" :style\x3d"dialogStyle"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/div\x3e'});
Vue.component("m-dialog",{name:"mDialog",props:{draggable:{type:Boolean,"default":!0},value:{type:Boolean,"default":!1},id:String,color:String,width:{type:String},title:{type:String}},data:function(){return{isShown:!1}},template:'\x3cq-dialog v-bind:value\x3d"value" v-on:input\x3d"$emit(\'input\', $event)" :id\x3d"id" @show\x3d"onShow" @hide\x3d"onHide" :maximized\x3d"$q.platform.is.mobile"\x3e\x3cq-card ref\x3d"dialogCard" flat bordered :style\x3d"{width:((width||760)+\'px\'),\'max-width\':($q.platform.is.mobile?\'100vw\':\'90vw\')}"\x3e\x3cq-card-actions ref\x3d"dialogHeader" :style\x3d"{cursor:(draggable?\'move\':\'default\')}"\x3e\x3ch5 class\x3d"q-pl-sm non-selectable"\x3e{{title}}\x3c/h5\x3e\x3cq-space\x3e\x3c/q-space\x3e\x3cq-btn icon\x3d"close" flat round dense v-close-popup\x3e\x3c/q-btn\x3e\x3c/q-card-actions\x3e\x3cq-separator\x3e\x3c/q-separator\x3e\x3cq-card-section ref\x3d"dialogBody"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/q-card-section\x3e\x3c/q-card\x3e\x3c/q-dialog\x3e',
methods:{onShow:function(){this.draggable&&this.$refs.dialogHeader.$el.addEventListener("mousedown",this.onGrab);this.focusFirst();this.$emit("onShow")},onHide:function(){this.draggable&&(document.removeEventListener("mousemove",this.onDrag),document.removeEventListener("mouseup",this.onLetGo),this.$refs.dialogHeader&&this.$refs.dialogHeader.$el.removeEventListener("mousedown",this.onGrab));this.$emit("onHide")},onDrag:function(a){var b=this.$refs.dialogCard.$el,c=window.getComputedStyle(b),d=parseInt(c.left)+
a.movementX;a=parseInt(c.top)+a.movementY;var e=window.innerWidth/2,f=window.innerHeight/2,g=b.offsetWidth/2,m=b.offsetHeight/2,c=-(e-g-10),e=e-g-10,g=-(f-m-10),f=f-m-10;d<c?d=c:d>e&&(d=e);a<g?a=g:a>f&&(a=f);b.style.left=d+"px";b.style.top=a+"px"},onLetGo:function(){document.removeEventListener("mousemove",this.onDrag);document.removeEventListener("mouseup",this.onLetGo)},onGrab:function(){document.addEventListener("mousemove",this.onDrag);document.addEventListener("mouseup",this.onLetGo)},focusFirst:function(){var a=
$(this.$refs.dialogBody.$el),b=a.find(".default-focus");b.length?b.focus():a.find("form :input:visible:not([type\x3d'submit']):first").focus()}}});
Vue.component("m-container-dialog",{name:"mContainerDialog",props:{id:String,color:String,buttonText:String,buttonClass:String,title:String,width:{type:String},openDialog:{type:Boolean,"default":!1},buttonIcon:{type:String,"default":"open_in_new"}},data:function(){return{isShown:!1}},template:'\x3cspan\x3e\x3cspan @click\x3d"show()"\x3e\x3cslot name\x3d"button"\x3e\x3cq-btn dense outline no-caps :icon\x3d"buttonIcon" :label\x3d"buttonText" :color\x3d"color" :class\x3d"buttonClass"\x3e\x3c/q-btn\x3e\x3c/slot\x3e\x3c/span\x3e\x3cm-dialog v-model\x3d"isShown" :id\x3d"id" :title\x3d"title" :color\x3d"color" :width\x3d"width"\x3e\x3cslot\x3e\x3c/slot\x3e\x3c/m-dialog\x3e\x3c/span\x3e',methods:{show:function(){this.isShown=
!0},hide:function(){this.isShown=!1}},mounted:function(){this.openDialog&&(this.isShown=!0)}});
Vue.component("m-dynamic-container",{name:"mDynamicContainer",props:{id:{type:String,required:!0},url:{type:String}},data:function(){return{curComponent:moqui.EmptyComponent,curUrl:""}},template:'\x3ccomponent :is\x3d"curComponent"\x3e\x3c/component\x3e',methods:{reload:function(){var a=this.curUrl;this.curUrl="";var b=this;setTimeout(function(){b.curUrl=a},20)},load:function(a){this.curUrl===a?this.reload():this.curUrl=a}},watch:{curUrl:function(a){if(a&&0!==a.length){var b=this;moqui.loadComponent(a,
function(a){b.curComponent=a},this.id)}else this.curComponent=moqui.EmptyComponent}},mounted:function(){this.$root.addContainer(this.id,this);this.curUrl=this.url}});
Vue.component("m-dynamic-dialog",{name:"mDynamicDialog",props:{id:{type:String},url:{type:String,required:!0},color:String,buttonText:String,buttonClass:String,title:String,width:{type:String},openDialog:{type:Boolean,"default":!1},dynamicParams:{type:Object,"default":null}},data:function(){return{curComponent:moqui.EmptyComponent,curUrl:"",isShown:!1}},template:'\x3cspan\x3e\x3cq-btn dense outline no-caps icon\x3d"open_in_new" :label\x3d"buttonText" :color\x3d"color" :class\x3d"buttonClass" @click\x3d"isShown \x3d true"\x3e\x3c/q-btn\x3e\x3cm-dialog ref\x3d"dialog" v-model\x3d"isShown" :id\x3d"id" :title\x3d"title" :color\x3d"color" :width\x3d"width"\x3e\x3ccomponent :is\x3d"curComponent"\x3e\x3c/component\x3e\x3c/m-dialog\x3e\x3c/span\x3e',
methods:{reload:function(){this.isShown&&(this.isShown=!1,this.isShown=!0)},load:function(a){this.curUrl=a},hide:function(){this.isShown=!1}},watch:{curUrl:function(a){if(a&&0!==a.length){var b=this;if(moqui.isPlainObject(this.dynamicParams)){var c="";$.each(this.dynamicParams,function(a,b){var f=$("#"+b).val();f&&f.length&&(c=c+(0<c.length?"\x26":"")+a+"\x3d"+f)});c.length&&(a=a+(0<a.indexOf("?")?"\x26":"?")+c)}moqui.loadComponent(a,function(a){a.mounted=function(){this.$nextTick(function(){b.$refs.dialog.focusFirst()})};
b.curComponent=a},this.id)}else this.curComponent=moqui.EmptyComponent},isShown:function(a){this.curUrl=a?this.url:""}},mounted:function(){this.$root.addContainer(this.id,this);this.openDialog&&(this.isShown=!0)}});
Vue.component("m-tree-top",{name:"mTreeTop",template:'\x3cul :id\x3d"id" class\x3d"tree-list"\x3e\x3cm-tree-item v-for\x3d"model in itemList" :key\x3d"model.id" :model\x3d"model" :top\x3d"top"/\x3e\x3c/ul\x3e',props:{id:{type:String,required:!0},items:{type:[String,Array],required:!0},openPath:String,parameters:Object},data:function(){return{urlItems:null,currentPath:null,top:this}},computed:{itemList:function(){return this.urlItems?this.urlItems:moqui.isArray(this.items)?this.items:[]}},methods:{},
mounted:function(){if(moqui.isString(this.items)){this.currentPath=this.openPath;var a=$.extend({moquiSessionToken:this.$root.moquiSessionToken,treeNodeId:"#",treeOpenPath:this.openPath},this.parameters),b=this;$.ajax({type:"POST",dataType:"json",url:this.items,headers:{Accept:"application/json"},data:a,error:moqui.handleAjaxError,success:function(a){b.urlItems=a}})}}});
Vue.component("m-tree-item",{name:"mTreeItem",template:'\x3cli :id\x3d"model.id"\x3e\x3ci v-if\x3d"isFolder" @click\x3d"toggle" class\x3d"fa" :class\x3d"{\'fa-chevron-right\':!open, \'fa-chevron-down\':open}"\x3e\x3c/i\x3e\x3ci v-else class\x3d"fa fa-square-o"\x3e\x3c/i\x3e \x3cspan @click\x3d"setSelected"\x3e\x3cm-link v-if\x3d"model.a_attr" :href\x3d"model.a_attr.urlText" :load-id\x3d"model.a_attr.loadId" :class\x3d"{\'text-success\':selected}"\x3e{{model.text}}\x3c/m-link\x3e\x3cspan v-if\x3d"!model.a_attr" :class\x3d"{\'text-success\':selected}"\x3e{{model.text}}\x3c/span\x3e\x3c/span\x3e\x3cul v-show\x3d"open" v-if\x3d"hasChildren"\x3e\x3cm-tree-item v-for\x3d"model in model.children" :key\x3d"model.id" :model\x3d"model" :top\x3d"top"/\x3e\x3c/ul\x3e\x3c/li\x3e',props:{model:Object,
top:Object},data:function(){return{open:!1}},computed:{isFolder:function(){var a=this.model.children;return a?moqui.isArray(a)?0<a.length:!0:!1},hasChildren:function(){var a=this.model.children;return moqui.isArray(a)&&0<a.length},selected:function(){return this.top.currentPath===this.model.id}},watch:{open:function(a){if(a){var b=this.model.children;a=this.top.items;if(this.open&&b&&moqui.isBoolean(b)&&moqui.isString(a)){var b=this.model.li_attr,b=$.extend({moquiSessionToken:this.$root.moquiSessionToken,
treeNodeId:this.model.id,treeNodeName:b&&b.treeNodeName?b.treeNodeName:"",treeOpenPath:this.top.currentPath},this.top.parameters),c=this;$.ajax({type:"POST",dataType:"json",url:a,headers:{Accept:"application/json"},data:b,error:moqui.handleAjaxError,success:function(a){c.model.children=a}})}}}},methods:{toggle:function(){this.isFolder&&(this.open=!this.open)},setSelected:function(){this.top.currentPath=this.model.id;this.open=!0}},mounted:function(){this.model.state&&this.model.state.opened&&(this.open=
!0)}});
Vue.component("m-editable",{name:"mEditable",props:{id:{type:String,required:!0},labelType:{type:String,"default":"span"},labelValue:{type:String,required:!0},url:{type:String,required:!0},urlParameters:{type:Object,"default":{}},parameterName:{type:String,"default":"value"},widgetType:{type:String,"default":"textarea"},loadUrl:String,loadParameters:Object,indicator:{type:String,"default":"Saving"},tooltip:{type:String,"default":"Click to edit"},cancel:{type:String,"default":"Cancel"},submit:{type:String,"default":"Save"}},
mounted:function(){$.extend({moquiSessionToken:this.$root.moquiSessionToken,parameterName:this.parameterName},this.urlParameters)},render:function(a){return a(this.labelType,{attrs:{id:this.id,"class":"editable-label"},domProps:{innerHTML:this.labelValue}})}});
moqui.checkboxSetMixin={props:{checkboxCount:{type:Number,"default":100},checkboxParameter:String,checkboxListMode:Boolean,checkboxValues:Array},data:function(){for(var a=[],b=0;b<this.checkboxCount;b++)a[b]=!1;return{checkboxAllState:!1,checkboxStates:a}},methods:{setCheckboxAllState:function(a){this.checkboxAllState=a;for(var b=this.checkboxStates.length,c=0;c<b;c++)this.checkboxStates[c]=a},getCheckboxValueArray:function(){if(!this.checkboxValues)return[];for(var a=[],b=this.checkboxStates.length,
c=0;c<b;c++)this.checkboxStates[c]&&this.checkboxValues[c]&&a.push(this.checkboxValues[c]);return a},addCheckboxParameters:function(a,b,c){b=b||this.checkboxParameter;var d=null!==c&&void 0!==c&&c?c:this.checkboxListMode;c=this.getCheckboxValueArray();if(!c.length)return!1;if(d)a.set(b,c.join(","));else{for(d=0;d<c.length;d++)a.set(b+"_"+d,c[d]);a.set("_isMulti","true")}return!0}},watch:{checkboxStates:{deep:!0,handler:function(a){for(var b=!0,c=0;c<a.length&&(a[c]||(b=!1),b);c++);this.checkboxAllState=
b}}}};Vue.component("m-checkbox-set",{name:"mCheckboxSet",mixins:[moqui.checkboxSetMixin],template:'\x3cspan class\x3d"checkbox-set"\x3e\x3cslot :checkboxAllState\x3d"checkboxAllState" :setCheckboxAllState\x3d"setCheckboxAllState" :checkboxStates\x3d"checkboxStates" :addCheckboxParameters\x3d"addCheckboxParameters"\x3e\x3c/slot\x3e\x3c/span\x3e'});
Vue.component("m-form",{name:"mForm",mixins:[moqui.checkboxSetMixin],props:{fieldsInitial:Object,action:{type:String,required:!0},method:{type:String,"default":"POST"},submitMessage:String,submitReloadId:String,submitHideId:String,focusField:String,noValidate:Boolean,excludeEmptyFields:Boolean,parentCheckboxSet:Object},data:function(){return{fields:Object.assign({},this.fieldsInitial),fieldsChanged:{},buttonClicked:null}},template:'\x3cq-form ref\x3d"qForm" @submit.prevent\x3d"submitForm" @reset.prevent\x3d"resetForm" autocapitalize\x3d"off" autocomplete\x3d"off"\x3e\x3cslot :fields\x3d"fields" :checkboxAllState\x3d"checkboxAllState" :setCheckboxAllState\x3d"setCheckboxAllState" :checkboxStates\x3d"checkboxStates" :addCheckboxParameters\x3d"addCheckboxParameters"\x3e\x3c/slot\x3e\x3c/q-form\x3e',
methods:{submitForm:function(){if(this.noValidate)this.submitGo();else{$(this.$el);var a=this;this.$refs.qForm.validate().then(function(b){b&&a.submitGo()})}},resetForm:function(){this.fields=Object.assign({},this.fieldsInitial);this.fieldsChanged={}},submitGo:function(){var a=this,b=$(this.$el),c=null,d=null,e=$(this.buttonClicked||document.activeElement);e.length&&b.has(e)&&e.is('button[type\x3d"submit"], input[type\x3d"submit"], input[type\x3d"image"]')&&(e.is("[name]")&&(c=e.attr("name"),d=e.val()),
e.prop("disabled",!0),setTimeout(function(){e.prop("disabled",!1)},3E3));var f=Object.keys(this.fields).length?new FormData:new FormData(this.$refs.qForm.$el);$.each(this.fields,function(a,b){f.set(a,b||"")});for(var b=[],g=f.entries()[Symbol.iterator]();;){var m=g.next();if(m.done)break;var k=m.value,m=k[0],k=k[1];moqui.isString(k)&&k.startsWith("__")&&f.set(m,"");!this.excludeEmptyFields||k&&k.length||b.push(m)}for(g=0;g<b.length;g++)f["delete"](b[g]);f.set("moquiSessionToken",this.$root.moquiSessionToken);
c&&f.set(c,d);this.parentCheckboxSet&&this.parentCheckboxSet.addCheckboxParameters&&this.parentCheckboxSet.addCheckboxParameters(f);this.$root.loading++;var h=new XMLHttpRequest;h.open(this.method,this.$root.appRootPath+this.action,!0);h.responseType="blob";h.withCredentials=!0;h.onload=function(){if(200===this.status){a.$root.loading--;var b=h.getResponseHeader("Content-Disposition");if(!b||-1===b.indexOf("attachment")&&-1===b.indexOf("inline")){var c=new FileReader;c.onload=function(b){b=b.target.result;
try{a.handleResponse(JSON.parse(b))}catch(c){a.handleResponse(b)}};c.readAsText(this.response)}else{var d=this.response,c="";b&&-1!==b.indexOf("attachment")&&(b=/filename[^;=\n]*=((['"]).*?\2|[^;\n]*)/.exec(b),null!=b&&b[1]&&(c=b[1].replace(/['"]/g,"")));if("undefined"!==typeof window.navigator.msSaveBlob)window.navigator.msSaveBlob(d,c);else{var e=window.URL||window.webkitURL,f=e.createObjectURL(d);c?(d=document.createElement("a"),"undefined"===typeof d.download?window.location.href=f:(d.href=f,
d.download=c,document.body.appendChild(d),d.click())):window.location.href=f;setTimeout(function(){e.revokeObjectURL(f)},100)}}}else moqui.handleLoadError(this,this.statusText,"")};h.setRequestHeader("Accept","application/json");h.send(f)},handleResponse:function(a){var b=!1;a&&moqui.isPlainObject(a)?(b=moqui.notifyMessages(a.messageInfos,a.errors),a.screenUrl&&0<a.screenUrl.length?this.$root.setUrl(a.screenUrl):a.redirectUrl&&0<a.redirectUrl.length&&(window.location.href=a.redirectUrl)):console.warn("m-form no response or non-JSON response: "+
JSON.stringify(a));(a=this.submitHideId)&&0<a.length&&$("#"+a).modal("hide");(a=this.submitReloadId)&&0<a.length&&this.$root.reloadContainer(a);(a=this.submitMessage)&&a.length?(b=eval('"'+a+'"'),moqui.webrootVue.$q.notify($.extend({},moqui.notifyOpts,{message:b})),moqui.webrootVue.addNotify(b,"success")):b||moqui.webrootVue.$q.notify($.extend({},moqui.notifyOpts,{message:"Submit successful"}))}},mounted:function(){var a=this,b=$(this.$el);this.focusField&&this.focusField.length&&b.find('[name^\x3d"'+
this.focusField+'"]').addClass("default-focus").focus();b.find('button[type\x3d"submit"], input[type\x3d"submit"], input[type\x3d"image"]').on("click",function(){a.buttonClicked=this})}});
Vue.component("m-form-link",{name:"mFormLink",props:{fieldsInitial:Object,action:{type:String,required:!0},focusField:String,noValidate:Boolean,bodyParameterNames:Array},data:function(){return{fields:Object.assign({},this.fieldsInitial)}},template:'\x3cq-form ref\x3d"qForm" @submit.prevent\x3d"submitForm" @reset.prevent\x3d"resetForm" autocapitalize\x3d"off" autocomplete\x3d"off"\x3e\x3cslot :clearForm\x3d"clearForm" :fields\x3d"fields"\x3e\x3c/slot\x3e\x3c/q-form\x3e',methods:{submitForm:function(){if(this.noValidate)this.submitGo();
else{var a=this;this.$refs.qForm.validate().then(function(b){b&&a.submitGo()})}},submitGo:function(){var a=null,b=null,c=$(document.activeElement);c.length&&c.is('button[type\x3d"submit"], input[type\x3d"submit"], input[type\x3d"image"]')&&(c.is("[name]")&&(a=c.attr("name"),b=c.val()),c.prop("disabled",!0),setTimeout(function(){c.prop("disabled",!1)},3E3));var d=Object.keys(this.fields).length?new FormData:new FormData(this.$refs.qForm.$el);$.each(this.fields,function(a,b){!b||moqui.isString(b)&&
b.startsWith("__")||d.set(a,b)});for(var e=[],f=[],g="",m=null,k=d.entries()[Symbol.iterator]();;){var h=k.next();if(h.done)break;var l=h.value,h=l[0],l=l[1];0===l.trim().length||"moquiSessionToken"===h||"moquiFormName"===h||0<h.indexOf("[]")||(0<h.indexOf("_op")||0<h.indexOf("_not")||0<h.indexOf("_ic")?e.push({name:h,value:l}):(f.push(h),this.bodyParameterNames&&0<=this.bodyParameterNames.indexOf(h)?(m||(m={}),m[h]=l):(0<g.length&&(g+="\x26"),g+=encodeURIComponent(h)+"\x3d"+encodeURIComponent(l))))}for(k=
0;k<e.length;k++)h=e[k],l=h.name.substring(0,h.name.indexOf("_")),0<=f.indexOf(l)&&(0<g.length&&(g+="\x26"),g+=encodeURIComponent(h.name)+"\x3d"+encodeURIComponent(h.value));a&&b&&b.trim().length&&(0<g.length&&(g+="\x26"),g+=encodeURIComponent(a)+"\x3d"+encodeURIComponent(b));a=this.action;a=0<a.indexOf("?")?a+"\x26"+g:a+"?"+g;this.$root.setUrl(a,m)},resetForm:function(){this.fields=Object.assign({},this.fieldsInitial)},clearForm:function(){this.fields={}}},mounted:function(){var a=$(this.$el);this.focusField&&
0<this.focusField.length&&a.find("[name\x3d"+this.focusField+"]").addClass("default-focus").focus()}});
Vue.component("m-form-paginate",{name:"mFormPaginate",props:{paginate:Object,formList:Object},template:'\x3cdiv v-if\x3d"paginate" class\x3d"q-pagination row no-wrap items-center"\x3e\x3ctemplate v-if\x3d"paginate.pageIndex \x3e 0"\x3e\x3cq-btn dense flat no-caps @click.prevent\x3d"setIndex(0)" icon\x3d"skip_previous"\x3e\x3c/q-btn\x3e\x3cq-btn dense flat no-caps @click.prevent\x3d"setIndex(paginate.pageIndex-1)" icon\x3d"fast_rewind"\x3e\x3c/q-btn\x3e\x3c/template\x3e\x3ctemplate v-else\x3e\x3cq-btn dense flat no-caps disabled icon\x3d"skip_previous"\x3e\x3c/q-btn\x3e\x3cq-btn dense flat no-caps disabled icon\x3d"fast_rewind"\x3e\x3c/q-btn\x3e\x3c/template\x3e\x3cq-btn v-for\x3d"prevIndex in prevArray" :key\x3d"prevIndex" dense flat no-caps @click.prevent\x3d"setIndex(prevIndex)" :label\x3d"prevIndex+1" color\x3d"primary"\x3e\x3c/q-btn\x3e\x3cq-btn dense flat no-caps disabled\x3e{{paginate.pageIndex+1}} / {{paginate.pageMaxIndex+1}} ({{paginate.pageRangeLow}}-{{paginate.pageRangeHigh}} / {{paginate.count}})\x3c/q-btn\x3e\x3cq-btn v-for\x3d"nextIndex in nextArray" :key\x3d"nextIndex" dense flat no-caps @click.prevent\x3d"setIndex(nextIndex)" :label\x3d"nextIndex+1" color\x3d"primary"\x3e\x3c/q-btn\x3e\x3ctemplate v-if\x3d"paginate.pageIndex \x3c paginate.pageMaxIndex"\x3e\x3cq-btn dense flat no-caps @click.prevent\x3d"setIndex(paginate.pageIndex+1)" icon\x3d"fast_forward"\x3e\x3c/q-btn\x3e\x3cq-btn dense flat no-caps @click.prevent\x3d"setIndex(paginate.pageMaxIndex)" icon\x3d"skip_next"\x3e\x3c/q-btn\x3e\x3c/template\x3e\x3ctemplate v-else\x3e\x3cq-btn dense flat no-caps disabled icon\x3d"fast_forward"\x3e\x3c/q-btn\x3e\x3cq-btn dense flat no-caps disabled icon\x3d"skip_next"\x3e\x3c/q-btn\x3e\x3c/template\x3e\x3c/div\x3e',computed:{prevArray:function(){var a=
this.paginate,b=[];if(!a||1>a.pageIndex)return b;var c=a.pageIndex,a=c-3;0>a&&(a=0);for(--c;a<=c;)b.push(a++);return b},nextArray:function(){var a=this.paginate,b=[];if(!a||a.pageIndex>=a.pageMaxIndex)return b;var c=a.pageIndex,a=a.pageMaxIndex,d=c+1,c=c+3;for(c>a&&(c=a);d<=c;)b.push(d++);return b}},methods:{setIndex:function(a){this.formList?this.formList.setPageIndex(a):this.$root.setParameters({pageIndex:a})}}});
Vue.component("m-form-go-page",{name:"mFormGoPage",props:{idVal:{type:String,required:!0},maxIndex:Number,formList:Object},data:function(){return{pageIndex:""}},template:'\x3cq-form v-if\x3d"!formList || (formList.paginate \x26\x26 formList.paginate.pageMaxIndex \x3e 4)" @submit.prevent\x3d"goPage"\x3e\x3cq-input dense v-model\x3d"pageIndex" type\x3d"text" size\x3d"4" name\x3d"pageIndex" placeholder\x3d"Page #"   :rules\x3d"[val \x3d\x3e /^\\d*$/.test(val) || \'digits only\', val \x3d\x3e ((formList \x26\x26 +val \x3c\x3d formList.paginate.pageMaxIndex) || (maxIndex \x26\x26 +val \x3c maxIndex)) || \'higher than max\']"\x3e\x3ctemplate v-slot:append\x3e\x3cq-btn dense flat no-caps type\x3d"submit" icon\x3d"redo" @click\x3d"goPage"\x3e\x3c/q-btn\x3e\x3c/template\x3e\x3c/q-input\x3e\x3c/q-form\x3e',
methods:{goPage:function(){var a=this.formList,b=+this.pageIndex-1;a?a.setPageIndex(b):this.$root.setParameters({pageIndex:b});var c=this;this.$nextTick(function(){c.pageIndex=""})}}});
Vue.component("m-form-column-config",{name:"mFormColumnConfig",props:{id:String,action:String,columnsInitial:{type:Array,required:!0},formLocation:{type:String,required:!0},findParameters:Object},data:function(){return{columns:moqui.deepCopy(this.columnsInitial)}},template:'\x3cm-form ref\x3d"mForm" :id\x3d"id" :action\x3d"action"\x3e\x3cq-list v-for\x3d"(column, columnIdx) in columns" :key\x3d"column.id" bordered dense\x3e\x3cq-item-label header\x3e{{column.label}}\x3c/q-item-label\x3e\x3cq-item v-for\x3d"(field, fieldIdx) in column.children" :key\x3d"field.id"\x3e\x3cq-item-section side v-if\x3d"columnIdx !\x3d\x3d 0"\x3e\x3cq-btn dense flat icon\x3d"cancel" @click\x3d"hideField(columnIdx, fieldIdx)"\x3e\x3cq-tooltip\x3eHide\x3c/q-tooltip\x3e\x3c/q-btn\x3e\x3c/q-item-section\x3e\x3cq-item-section\x3e\x3cq-item-label\x3e{{field.label}}\x3c/q-item-label\x3e\x3c/q-item-section\x3e\x3cq-item-section v-if\x3d"columnIdx \x3d\x3d\x3d 0" side\x3e\x3cq-btn-dropdown dense outline no-caps label\x3d"Display"\x3e\x3cq-list dense\x3e\x3cq-item v-for\x3d"(toColumn, toColumnIdx) in columns.slice(1)" :key\x3d"toColumn.id" clickable\x3e\x3cq-item-section @click\x3d"moveToCol(columnIdx, fieldIdx, toColumnIdx+1)"\x3e{{toColumn.label}}\x3c/q-item-section\x3e\x3c/q-item\x3e\x3cq-item clickable\x3e\x3cq-item-section @click\x3d"moveToCol(columnIdx, fieldIdx, columns.length+1)"\x3eNew Column\x3c/q-item-section\x3e\x3c/q-item\x3e\x3c/q-list\x3e\x3c/q-btn-dropdown\x3e\x3c/q-item-section\x3e\x3cq-item-section v-else side\x3e\x3cq-btn-group flat\x3e\x3cq-btn :disabled\x3d"columnIdx \x3c\x3d 1" dense flat icon\x3d"north" @click\x3d"moveToCol(columnIdx, fieldIdx, columnIdx-1)"\x3e\x3c/q-btn\x3e\x3cq-btn :disabled\x3d"fieldIdx \x3d\x3d\x3d 0" dense flat icon\x3d"expand_less" @click\x3d"moveInCol(columnIdx, fieldIdx, fieldIdx-1)"\x3e\x3c/q-btn\x3e\x3cq-btn :disabled\x3d"(fieldIdx + 1) \x3d\x3d\x3d column.children.length" dense flat icon\x3d"expand_more" @click\x3d"moveInCol(columnIdx, fieldIdx, fieldIdx+1)"\x3e\x3c/q-btn\x3e\x3cq-btn dense flat icon\x3d"south" @click\x3d"moveToCol(columnIdx, fieldIdx, columnIdx+1)"\x3e\x3c/q-btn\x3e\x3c/q-btn-group\x3e\x3c/q-item-section\x3e\x3c/q-item\x3e\x3c/q-list\x3e\x3cdiv class\x3d"q-my-md"\x3e\x3cq-btn dense outline no-caps @click.prevent\x3d"saveColumns()" label\x3d"Save Changes"\x3e\x3c/q-btn\x3e\x3cq-btn dense outline no-caps @click.prevent\x3d"resetColumns()" label\x3d"Undo Changes"\x3e\x3c/q-btn\x3e\x3cq-btn dense outline no-caps @click.prevent\x3d"resetToDefault()" label\x3d"Reset to Default"\x3e\x3c/q-btn\x3e\x3c/div\x3e\x3c/m-form\x3e',methods:{moveInCol:function(a,
b,c){a=this.columns[a].children;b=a.splice(b,1)[0];a.splice(c,0,b)},moveToCol:function(a,b,c){a=this.columns[a];c=c>=this.columns.length?this.addColumn():this.columns[c];b=a.children.splice(b,1)[0];c.children.push(b)},addColumn:function(){var a=this.columns.length,b=this.columns[a-1],c=b.id.split("_")[0]+"_"+a,b=b.label.split(" ")[0]+" "+a;this.columns.push({id:c,label:b,children:[]});return this.columns[a]},hideField:function(a,b){if(0!==a){var c=this.columns[0],d=this.columns[a].children.splice(b,
1)[0];c.children.push(d)}},resetColumns:function(){this.columns=moqui.deepCopy(this.columnsInitial)},saveColumns:function(){this.generalFormFields();var a=this.$refs.mForm.fields;a.SaveColumns="SaveColumns";a.columnsTree=JSON.stringify(this.columns);this.$refs.mForm.submitGo()},resetToDefault:function(){this.generalFormFields();this.$refs.mForm.fields.ResetColumns="ResetColumns";this.$refs.mForm.submitGo()},generalFormFields:function(){var a=this.$refs.mForm.fields;a.formLocation=this.formLocation;
if(this.findParameters)for(var b in Object.keys(this.findParameters))a[b]=this.findParameters[b];console.log("Save column config "+this.formLocation+" Window Width "+window.innerWidth+" Quasar Platform: "+JSON.stringify(Quasar.Platform.is));if(600>=window.innerWidth||Quasar.Platform.is.mobile)a._uiType="mobile"}}});
Vue.component("m-form-list",{name:"mFormList",props:{name:{type:String,required:!0},id:String,rows:{type:[String,Array],required:!0},search:{type:Object},action:String,multi:Boolean,skipForm:Boolean,skipHeader:Boolean,headerForm:Boolean,headerDialog:Boolean,savedFinds:Boolean,selectColumns:Boolean,allButton:Boolean,csvButton:Boolean,textButton:Boolean,pdfButton:Boolean,columns:[String,Number]},data:function(){return{rowList:[],paginate:null,searchObj:null,moqui:moqui}},template:'\x3cdiv\x3e\x3ctemplate v-if\x3d"!multi \x26\x26 !skipForm"\x3e\x3cm-form v-for\x3d"(fields, rowIndex) in rowList" :name\x3d"idVal+\'_\'+rowIndex" :id\x3d"idVal+\'_\'+rowIndex" :action\x3d"action"\x3e\x3cslot name\x3d"rowForm" :fields\x3d"fields"\x3e\x3c/slot\x3e\x3c/m-form\x3e\x3c/template\x3e\x3cm-form v-if\x3d"multi \x26\x26 !skipForm" :name\x3d"idVal" :id\x3d"idVal" :action\x3d"action"\x3e\x3cinput type\x3d"hidden" name\x3d"moquiFormName" :value\x3d"name"\x3e\x3cinput type\x3d"hidden" name\x3d"_isMulti" value\x3d"true"\x3e\x3ctemplate v-for\x3d"(fields, rowIndex) in rowList"\x3e\x3cslot name\x3d"rowForm" :fields\x3d"fields"\x3e\x3c/slot\x3e\x3c/template\x3e\x3c/m-form\x3e\x3cm-form-link v-if\x3d"!skipHeader \x26\x26 headerForm \x26\x26 !headerDialog" :name\x3d"idVal+\'_header\'" :id\x3d"idVal+\'_header\'" :action\x3d"$root.currentLinkPath"\x3e\x3cinput v-if\x3d"searchObj \x26\x26 searchObj.orderByField" type\x3d"hidden" name\x3d"orderByField" :value\x3d"searchObj.orderByField"\x3e\x3cslot name\x3d"headerForm" :search\x3d"searchObj"\x3e\x3c/slot\x3e\x3c/m-form-link\x3e\x3cdiv class\x3d"q-table__container q-table__card q-table--horizontal-separator q-table--dense q-table--flat"\x3e\x3ctable class\x3d"q-table" :id\x3d"idVal+\'_table\'"\x3e\x3cthead\x3e\x3ctr class\x3d"form-list-nav-row"\x3e\x3cth :colspan\x3d"columns?columns:\'100\'"\x3e\x3cq-bar\x3e\x3cbutton v-if\x3d"savedFinds || headerDialog" :id\x3d"idVal+\'_hdialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_hdialog\'" data-original-title\x3d"Find Options" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e Find Options\x3c/button\x3e\x3cbutton v-if\x3d"selectColumns" :id\x3d"idVal+\'_SelColsDialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_SelColsDialog\'" data-original-title\x3d"Columns" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e Columns\x3c/button\x3e\x3cm-form-paginate :paginate\x3d"paginate" :form-list\x3d"this"\x3e\x3c/m-form-paginate\x3e\x3cm-form-go-page :id-val\x3d"idVal" :form-list\x3d"this"\x3e\x3c/m-form-go-page\x3e\x3ca v-if\x3d"csvButton" :href\x3d"csvUrl" class\x3d"btn btn-default"\x3eCSV\x3c/a\x3e\x3cbutton v-if\x3d"textButton" :id\x3d"idVal+\'_TextDialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_TextDialog\'" data-original-title\x3d"Text" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e Text\x3c/button\x3e\x3cbutton v-if\x3d"pdfButton" :id\x3d"idVal+\'_PdfDialog_button\'" type\x3d"button" data-toggle\x3d"modal" :data-target\x3d"\'#\'+idVal+\'_PdfDialog\'" data-original-title\x3d"PDF" data-placement\x3d"bottom" class\x3d"btn btn-default"\x3e\x3ci class\x3d"fa fa-share"\x3e\x3c/i\x3e PDF\x3c/button\x3e\x3cslot name\x3d"nav"\x3e\x3c/slot\x3e\x3c/q-bar\x3e\x3c/th\x3e\x3c/tr\x3e\x3cslot name\x3d"header" :search\x3d"searchObj"\x3e\x3c/slot\x3e\x3c/thead\x3e\x3ctbody\x3e\x3ctr v-for\x3d"(fields, rowIndex) in rowList"\x3e\x3cslot name\x3d"row" :fields\x3d"fields" :row-index\x3d"rowIndex" :moqui\x3d"moqui"\x3e\x3c/slot\x3e\x3c/tr\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e',
computed:{idVal:function(){return this.id&&0<this.id.length?this.id:this.name},csvUrl:function(){return this.$root.currentPath+"?"+moqui.objToSearch($.extend({},this.searchObj,{renderMode:"csv",pageNoLimit:"true",lastStandalone:"true",saveFilename:this.name+".csv"}))}},methods:{fetchRows:function(){if(moqui.isArray(this.rows))console.warn("Tried to fetch form-list-body rows but rows prop is an array");else{var a=this,b=this.search;b||(b=this.$root.currentParameters);var c=this.rows;-1===c.indexOf("/")&&
(c=this.$root.currentPath+"/actions/"+c);console.info("Fetching rows with url "+c+" searchObj "+JSON.stringify(b));$.ajax({type:"GET",url:c,data:b,dataType:"json",headers:{Accept:"application/json"},error:moqui.handleAjaxError,success:function(b,c,f){b&&moqui.isArray(b)&&(c=f.getResponseHeader,(f=Number(c("X-Total-Count")))&&!isNaN(f)&&(a.paginate={count:Number(f),pageIndex:Number(c("X-Page-Index")),pageSize:Number(c("X-Page-Size")),pageMaxIndex:Number(c("X-Page-Max-Index")),pageRangeLow:Number(c("X-Page-Range-Low")),
pageRangeHigh:Number(c("X-Page-Range-High"))}),a.rowList=b,console.info("Fetched "+b.length+" rows, paginate: "+JSON.stringify(a.paginate)))}})}},setPageIndex:function(a){this.searchObj?this.searchObj.pageIndex=a:this.searchObj={pageIndex:a};this.fetchRows()}},watch:{rows:function(a){moqui.isArray(a)?this.rowList=a:this.fetchRows()},search:function(){this.fetchRows()}},mounted:function(){this.searchObj=this.search?this.search:this.$root.currentParameters;moqui.isArray(this.rows)?this.rowList=this.rows:
this.fetchRows()}});
Vue.component("m-date-time",{name:"mDateTime",props:{id:String,name:{type:String,required:!0},value:String,type:{type:String,"default":"date-time"},label:String,size:String,format:String,tooltip:String,form:String,required:String,rules:Array,disable:Boolean,autoYear:String,minuteStep:{type:Number,"default":5}},template:'\x3cq-input dense outlined stack-label :label\x3d"label" v-bind:value\x3d"value" v-on:input\x3d"$emit(\'input\', $event)" :rules\x3d"rules" :mask\x3d"inputMask" fill-mask :id\x3d"id" :name\x3d"name" :form\x3d"form" :disable\x3d"disable" :size\x3d"sizeVal" style\x3d"max-width:max-content;"\x3e\x3ctemplate v-slot:prepend v-if\x3d"type\x3d\x3d\'date\' || type\x3d\x3d\'date-time\' || !type"\x3e\x3cq-icon name\x3d"event" class\x3d"cursor-pointer"\x3e\x3cq-popup-proxy ref\x3d"qDateProxy" transition-show\x3d"scale" transition-hide\x3d"scale"\x3e\x3cq-date v-bind:value\x3d"value" v-on:input\x3d"$emit(\'input\', $event)" :mask\x3d"formatVal" @input\x3d"function(){$refs.qDateProxy.hide()}"\x3e\x3c/q-date\x3e\x3c/q-popup-proxy\x3e\x3c/q-icon\x3e\x3c/template\x3e\x3ctemplate v-slot:append v-if\x3d"type\x3d\x3d\'time\' || type\x3d\x3d\'date-time\' || !type"\x3e\x3cq-icon name\x3d"access_time" class\x3d"cursor-pointer"\x3e\x3cq-popup-proxy ref\x3d"qTimeProxy" transition-show\x3d"scale" transition-hide\x3d"scale"\x3e\x3cq-time v-bind:value\x3d"value" v-on:input\x3d"$emit(\'input\', $event)" :mask\x3d"formatVal" format24h @input\x3d"function(){$refs.qTimeProxy.hide()}"\x3e\x3c/q-time\x3e\x3c/q-popup-proxy\x3e\x3c/q-icon\x3e\x3c/template\x3e\x3ctemplate v-slot:after\x3e\x3cslot name\x3d"after"\x3e\x3c/slot\x3e\x3c/template\x3e\x3c/q-input\x3e',methods:{focusDate:function(a){"time"!==
this.type&&"false"!==this.autoYear&&(a=this.value,a&&a.length||(a=this.autoYear&&this.autoYear.match(/^[12]\d\d\d$/)?this.autoYear:(new Date).getFullYear(),this.$emit("input",a)))},blurDate:function(a){"time"!==this.type&&(a=this.value,0<a.indexOf("d")?this.$emit("input",""):0<a.indexOf("hh:mm")?this.$emit("input",a.replace("hh:mm","12:00")):0<a.indexOf(":mm")&&this.$emit("input",a.replace(":mm",":00")))}},computed:{formatVal:function(){var a=this.format;return a&&a.length?a:"time"===this.type?"HH:mm":
"date"===this.type?"YYYY-MM-DD":"YYYY-MM-DD HH:mm"},inputMask:function(){return this.formatVal.replace(/\w/g,"#")},extraFormatsVal:function(){return"time"===this.type?["LT","LTS","HH:mm"]:"date"===this.type?["l","L","YYYY-MM-DD"]:["YYYY-MM-DD HH:mm","YYYY-MM-DD HH:mm:ss","MM/DD/YYYY HH:mm"]},sizeVal:function(){var a=this.size;return a&&a.length?a:"time"===this.type?"9":"date"===this.type?"10":"16"},timePattern:function(){return"^(?:(?:([01]?\\d|2[0-3]):)?([0-5]?\\d):)?([0-5]?\\d)$"}},mounted:function(){$(this.$el)}});
moqui.dateOffsets=[{value:"0",label:"This"},{value:"-1",label:"Last"},{value:"1",label:"Next"},{value:"-2",label:"-2"},{value:"2",label:"+2"},{value:"-3",label:"-3"},{value:"-4",label:"-4"},{value:"-6",label:"-6"},{value:"-12",label:"-12"}];
moqui.datePeriods=[{value:"day",label:"Day"},{value:"7d",label:"7 Days"},{value:"30d",label:"30 Days"},{value:"week",label:"Week"},{value:"weeks",label:"Weeks"},{value:"month",label:"Month"},{value:"months",label:"Months"},{value:"quarter",label:"Quarter"},{value:"year",label:"Year"},{value:"7r",label:"+/-7d"},{value:"30r",label:"+/-30d"}];moqui.emptyOpt={value:"",label:""};
Vue.component("m-date-period",{name:"mDatePeriod",props:{fields:{type:Object,required:!0},name:{type:String,required:!0},id:String,allowEmpty:Boolean,fromThruType:{type:String,"default":"date"},form:String,tooltip:String,label:String},data:function(){return{fromThruMode:!1,dateOffsets:moqui.dateOffsets.slice(),datePeriods:moqui.datePeriods.slice()}},template:'\x3cdiv v-if\x3d"fromThruMode" class\x3d"row"\x3e\x3cm-date-time :name\x3d"name+\'_from\'" :id\x3d"id+\'_from\'" :label\x3d"label+\' From\'" :form\x3d"form" :type\x3d"fromThruType" v-model\x3d"fields[name+\'_from\']"\x3e\x3c/m-date-time\x3e\x3cq-icon class\x3d"q-my-auto" name\x3d"remove"\x3e\x3c/q-icon\x3e\x3cm-date-time :name\x3d"name+\'_thru\'" :id\x3d"id+\'_thru\'" :label\x3d"label+\' Thru\'" :form\x3d"form" :type\x3d"fromThruType" v-model\x3d"fields[name+\'_thru\']"\x3e\x3ctemplate v-slot:after\x3e\x3cq-btn dense flat icon\x3d"calendar_view_day" @click\x3d"toggleMode"\x3e\x3cq-tooltip\x3ePeriod Select Mode\x3c/q-tooltip\x3e\x3c/q-btn\x3e\x3cq-btn dense flat icon\x3d"clear" @click\x3d"clearAll"\x3e\x3cq-tooltip\x3eClear\x3c/q-tooltip\x3e\x3c/q-btn\x3e\x3c/template\x3e\x3c/m-date-time\x3e\x3c/div\x3e\x3cdiv v-else class\x3d"row"\x3e\x3cq-input dense outlined stack-label :label\x3d"label" v-model\x3d"fields[name+\'_pdate\']" mask\x3d"####-##-##" fill-mask :id\x3d"id" :name\x3d"name+\'_pdate\'" :form\x3d"form" style\x3d"max-width:max-content;"\x3e\x3cq-tooltip v-if\x3d"tooltip"\x3e{{tooltip}}\x3c/q-tooltip\x3e\x3ctemplate v-slot:before\x3e\x3cq-select class\x3d"q-pr-xs" dense outlined options-dense emit-value map-options v-model\x3d"fields[name+\'_poffset\']" :name\x3d"name+\'_poffset\'" stack-label label\x3d"Offset" :options\x3d"dateOffsets" :form\x3d"form" behavior\x3d"menu"\x3e\x3c/q-select\x3e\x3cq-select dense outlined options-dense emit-value map-options v-model\x3d"fields[name+\'_period\']" :name\x3d"name+\'_period\'" stack-label label\x3d"Period" :options\x3d"datePeriods" :form\x3d"form" behavior\x3d"menu"\x3e\x3c/q-select\x3e\x3c/template\x3e\x3ctemplate v-slot:prepend\x3e\x3cq-icon name\x3d"event" class\x3d"cursor-pointer"\x3e\x3cq-popup-proxy ref\x3d"qDateProxy" transition-show\x3d"scale" transition-hide\x3d"scale"\x3e\x3cq-date v-model\x3d"fields[name+\'_pdate\']" mask\x3d"YYYY-MM-DD" @input\x3d"function(){$refs.qDateProxy.hide()}"\x3e\x3c/q-date\x3e\x3c/q-popup-proxy\x3e\x3c/q-icon\x3e\x3c/template\x3e\x3ctemplate v-slot:after\x3e\x3cq-btn dense flat icon\x3d"date_range" @click\x3d"toggleMode"\x3e\x3cq-tooltip\x3eDate Range Mode\x3c/q-tooltip\x3e\x3c/q-btn\x3e\x3cq-btn dense flat icon\x3d"clear" @click\x3d"clearAll"\x3e\x3cq-tooltip\x3eClear\x3c/q-tooltip\x3e\x3c/q-btn\x3e\x3c/template\x3e\x3c/q-input\x3e\x3c/div\x3e',
methods:{toggleMode:function(){this.fromThruMode=!this.fromThruMode},clearAll:function(){this.fields[this.name+"_pdate"]=null;this.fields[this.name+"_poffset"]=null;this.fields[this.name+"_period"]=null;this.fields[this.name+"_from"]=null;this.fields[this.name+"_thru"]=null}},mounted:function(){var a=this.fields[this.name+"_from"],b=this.fields[this.name+"_thru"];if(a&&a.length||b&&b.length)this.fromThruMode=!0}});
Vue.component("m-display",{name:"mDisplay",props:{value:String,display:String,valueUrl:String,valueParameters:Object,dependsOn:Object,dependsOptional:Boolean,valueLoadInit:Boolean,fields:{type:Object},tooltip:String,label:String,labelWrapper:Boolean,name:String,id:String},data:function(){return{curDisplay:this.display,loading:!1}},template:'\x3cq-input v-if\x3d"labelWrapper" dense outlined readonly stack-label :value\x3d"displayValue" :label\x3d"label" :id\x3d"id" :name\x3d"name" :loading\x3d"loading"\x3e\x3cq-tooltip v-if\x3d"tooltip"\x3e{{tooltip}}\x3c/q-tooltip\x3e\x3c/q-input\x3e\x3cspan v-else :id\x3d"id"\x3e\x3cq-tooltip v-if\x3d"tooltip"\x3e{{tooltip}}\x3c/q-tooltip\x3e\x3cslot\x3e\x3c/slot\x3e{{displayValue}}\x3c/span\x3e',
methods:{serverData:function(){var a=!0,b=this.dependsOn,c=this.valueParameters,d={moquiSessionToken:this.$root.moquiSessionToken},e;for(e in c)c.hasOwnProperty(e)&&(d[e]=c[e]);for(var f in b)b.hasOwnProperty(f)&&(this.fields?c=this.fields[b[f]]:(e=$("#"+b[f]),(c=e.val())||(c=e.find("select").val())),c?d[f]=c:a=!1);d.hasAllParms=a;return d},populateFromUrl:function(a){a=this.serverData(a);if(this.valueUrl&&this.valueUrl.length)if(a.hasAllParms||this.dependsOptional){var b=this;this.loading=!0;$.ajax({type:"POST",
url:this.valueUrl,data:a,dataType:"text",headers:{Accept:"text/plain"},error:function(a,d,e){b.loading=!1;moqui.handleAjaxError(a,d,e)},success:function(a){b.loading=!1;var d="",e="";try{var f=JSON.parse(a);$.isArray(f)&&f.length?f=f[0]:$.isPlainObject(f)&&f.hasOwnProperty("options")&&f.options.length&&(f=f.options[0]);f.hasOwnProperty("label")&&(d=f.label);f.hasOwnProperty("value")&&(e=f.value)}catch(g){}d&&d.length||(d=a);e&&e.length||(e=a);moqui.isNumber(e)&&(e=e.toString());b.$emit("input",e);
b.fields&&b.fields.length&&b.name&&b.name.length&&(b.fields[b.name+"_display"]=d);b.curDisplay=d}})}else console.warn("In m-display for "+this.name+"  tried to populateFromUrl but not hasAllParms and not dependsOptional"),this.$emit("input",null),this.curDisplay=null;else console.warn("In m-display for "+this.name+" tried to populateFromUrl but no valueUrl")}},computed:{displayValue:function(){return this.curDisplay&&this.curDisplay.length?this.curDisplay:this.value}},mounted:function(){if(this.valueUrl&&
this.valueUrl.length){var a=this.dependsOn,b;for(b in a)a.hasOwnProperty(b)&&this.fields&&this.$watch("fields."+b,function(){this.populateFromUrl({term:this.value})});this.valueLoadInit&&this.populateFromUrl()}}});
Vue.component("m-drop-down",{name:"mDropDown",props:{value:[Array,String],options:{type:Array,"default":function(){return[]}},combo:Boolean,allowEmpty:Boolean,multiple:Boolean,requiredManualSelect:Boolean,optionsUrl:String,optionsParameters:Object,optionsLoadInit:Boolean,serverSearch:Boolean,serverDelay:{type:Number,"default":300},serverMinLength:{type:Number,"default":1},labelField:{type:String,"default":"label"},valueField:{type:String,"default":"value"},dependsOn:Object,dependsOptional:Boolean,
form:String,fields:{type:Object},tooltip:String,label:String,name:String,id:String,disable:Boolean,onSelectGoTo:String},data:function(){return{curOptions:this.options,allOptions:this.options,lastVal:null,lastSearch:null,loading:!1}},template:'\x3cq-select ref\x3d"qSelect" v-bind:value\x3d"value" v-on:input\x3d"handleInput($event)" dense outlined options-dense use-input :hide-selected\x3d"multiple" :name\x3d"name" :id\x3d"id" :form\x3d"form" input-debounce\x3d"500" @filter\x3d"filterFn" :clearable\x3d"allowEmpty||multiple" :disable\x3d"disable" :multiple\x3d"multiple" :emit-value\x3d"!onSelectGoTo" map-options behavior\x3d"menu" :rules\x3d"[val \x3d\x3e allowEmpty||multiple||val\x3d\x3d\x3d\'\'||(val\x26\x26val.length)||\'Please select an option\']" stack-label :label\x3d"label" :loading\x3d"loading" :options\x3d"curOptions"\x3e\x3cq-tooltip v-if\x3d"tooltip"\x3e{{tooltip}}\x3c/q-tooltip\x3e\x3ctemplate v-slot:no-option\x3e\x3cq-item\x3e\x3cq-item-section class\x3d"text-grey"\x3eNo results\x3c/q-item-section\x3e\x3c/q-item\x3e\x3c/template\x3e\x3ctemplate v-if\x3d"multiple" v-slot:prepend\x3e\x3cdiv\x3e\x3cq-chip v-for\x3d"valueEntry in value" :key\x3d"valueEntry" dense size\x3d"md" class\x3d"q-my-xs" removable @remove\x3d"removeValue(valueEntry)"\x3e{{optionLabel(valueEntry)}}\x3c/q-chip\x3e\x3c/div\x3e\x3c/template\x3e\x3ctemplate v-slot:append\x3e\x3cslot name\x3d"append"\x3e\x3c/slot\x3e\x3c/template\x3e\x3ctemplate v-slot:after\x3e\x3cslot name\x3d"after"\x3e\x3c/slot\x3e\x3c/template\x3e\x3c/q-select\x3e',
methods:{handleInput:function(a){this.onSelectGoTo&&this.onSelectGoTo.length?a[this.onSelectGoTo]&&this.$root.setUrl(a[this.onSelectGoTo]):this.$emit("input",a)},filterFn:function(a,b,c){if(this.serverSearch)this.lastSearch===a||this.serverMinLength&&(a?a.length:0)<this.serverMinLength?b():(this.lastSearch=a,this.populateFromUrl({term:a},b,c));else if(this.allOptions&&this.allOptions.length){var d=this;a&&a.length?b(function(){var b=a.toLowerCase();d.curOptions=d.allOptions.filter(function(a){return a.label&&
-1<a.label.toLowerCase().indexOf(b)})}):(d.curOptions?d.curOptions.length:0)===(d.allOptions?d.allOptions.length:0)?b():b(function(){d.curOptions=d.allOptions})}else this.optionsUrl&&this.optionsUrl.length?this.populateFromUrl({},b,c):(console.error("m-drop-down "+this.name+" has no options and no options-url"),c())},processOptionList:function(a,b,c){var d=[],e=this.labelField,f=this.valueField;$.each(a,function(a,b){var c=b[f],h=b[e];d.push(Object.assign(b,{value:c||h,label:h||c}))});return d},serverData:function(a){var b=
!0,c=this.dependsOn,d=this.optionsParameters,e={moquiSessionToken:this.$root.moquiSessionToken},f;for(f in d)d.hasOwnProperty(f)&&(e[f]=d[f]);for(var g in c)c.hasOwnProperty(g)&&(this.fields?d=this.fields[c[g]]:(f=$("#"+c[g]),(d=f.val())||(d=f.find("select").val())),d?e[g]=d:b=!1);a?(e.term=a.term||"",e.pageIndex=(a.page||1)-1):this.serverSearch&&(e.term="",e.pageIndex=0);e.hasAllParms=b;return e},processResponse:function(a,b){if(moqui.isArray(a))return{results:this.processOptionList(a,null,b.term)};
b.page=b.page||1;var c=a.pageSize||20;return{results:this.processOptionList(a.options,b.page,b.term),pagination:{more:a.count?b.page*c<a.count:!1}}},populateFromUrl:function(a,b,c){var d=this.serverData(a);if(this.optionsUrl&&this.optionsUrl.length)if(d.hasAllParms||this.dependsOptional){var e=this;this.loading=!0;$.ajax({type:"POST",url:this.optionsUrl,data:d,dataType:"json",headers:{Accept:"application/json"},error:function(a,b,d){e.loading=!1;moqui.handleAjaxError(a,b,d);c&&c()},success:function(c){e.loading=
!1;c=moqui.isArray(c)?c:c.options;var d=e.processOptionList(c,null,a?a.term:null);c&&(b?b(function(){e.setNewOptions(d)}):(e.setNewOptions(d),e.$refs.qSelect&&e.$refs.qSelect.refresh()))}})}else console.warn("In m-drop-down tried to populateFromUrl but not hasAllParms and not dependsOptional"),this.curOptions=[],this.allOptions=[],c&&c();else console.warn("In m-drop-down tried to populateFromUrl but no optionsUrl"),c&&c()},setNewOptions:function(a){this.curOptions=a;if(this.multiple&&this.allOptions&&
this.allOptions.length&&this.value&&this.value.length&&moqui.isArray(this.value)){a=a.slice();for(var b=0;b<this.value.length;b++)for(var c=this.value[b],d=0;d<this.allOptions.length;d++){var e=this.allOptions[d];c===e.value&&a.push(e)}this.allOptions=a}else this.allOptions=a,this.checkCurrentValue(this.allOptions)},checkCurrentValue:function(a){var b=!1,c=moqui.isArray(this.value);if(this.value&&this.value.length&&a)for(var d=0;d<a.length;d++){var e=a[d];if(c?this.value.includes(e.value):e.value===
this.value){b=!0;break}}b||(this.allowEmpty||this.multiple||!a||!a.length||!a[0].value||this.requiredManualSelect&&1!==a.length?this.$emit("input",null):this.$emit("input",a[0].value))},optionLabel:function(a){var b=this.allOptions;if(!b||!b.length)return"";for(var c=0;c<b.length;c++){var d=b[c];if(a===d.value)return d.label}return""},removeValue:function(a){var b=this.value;if(moqui.isArray(b)){for(var c=[],d=0;d<b.length;d++){var e=b[d];e!==a&&c.push(e)}b.length!==c.length&&this.$emit("input",c)}else console.warn("Tried to remove value from m-drop-down multiple "+
this.name+" but value is not an Array")},clearAll:function(){this.$emit("input",null)}},mounted:function(){this.serverSearch&&(this.optionsUrl||console.error("m-drop-down in form "+this.form+" has no options-url but has server-search\x3dtrue"));if(this.optionsUrl&&this.optionsUrl.length){var a=this.dependsOn,b;for(b in a)if(a.hasOwnProperty(b)&&this.fields){var c=this;this.$watch("fields."+a[b],function(){c.$emit("input",null);c.populateFromUrl({term:c.lastSearch})})}this.optionsLoadInit&&(this.serverSearch?
this.value&&this.value.length&&moqui.isString(this.value)&&this.populateFromUrl({term:this.value}):this.populateFromUrl())}this.multiple||this.allowEmpty||this.value&&this.value.length||!this.options||!this.options.length||this.requiredManualSelect&&1!==this.options.length||this.$emit("input",this.options[0].value)}});
Vue.component("m-text-line",{name:"mTextLine",props:{value:String,type:{type:String,"default":"text"},id:String,name:String,size:String,fields:{type:Object},label:String,tooltip:String,prefix:String,disable:Boolean,mask:String,fillMask:String,rules:Array,defaultUrl:String,defaultParameters:Object,dependsOn:Object,dependsOptional:Boolean,defaultLoadInit:Boolean},data:function(){return{loading:!1}},template:'\x3cq-input dense outlined stack-label :label\x3d"label" :prefix\x3d"prefix" v-bind:value\x3d"value" v-on:input\x3d"$emit(\'input\', $event)" :type\x3d"type" :id\x3d"id" :name\x3d"name" :size\x3d"size" :loading\x3d"loading" :rules\x3d"rules" :disable\x3d"disable" :mask\x3d"mask" :fill-mask\x3d"fillMask" autocapitalize\x3d"off" autocomplete\x3d"off"\x3e\x3cq-tooltip v-if\x3d"tooltip"\x3e{{tooltip}}\x3c/q-tooltip\x3e\x3c/q-input\x3e',
methods:{serverData:function(){var a=!0,b=this.dependsOn,c=this.defaultParameters,d={moquiSessionToken:this.$root.moquiSessionToken},e;for(e in c)c.hasOwnProperty(e)&&(d[e]=c[e]);for(var f in b)b.hasOwnProperty(f)&&(this.fields?c=this.fields[b[f]]:(e=$("#"+b[f]),(c=e.val())||(c=e.find("select").val())),c?d[f]=c:a=!1);d.hasAllParms=a;return d},populateFromUrl:function(a){a=this.serverData(a);if(this.defaultUrl&&this.defaultUrl.length)if(a.hasAllParms||this.dependsOptional){var b=this;this.loading=
!0;$.ajax({type:"POST",url:this.defaultUrl,data:a,dataType:"text",error:function(a,d,e){b.loading=!1;moqui.handleAjaxError(a,d,e)},success:function(a){b.loading=!1;a&&a.length&&b.$emit("input",a)}})}else console.warn("In m-text-line tried to populateFromUrl but not hasAllParms and not dependsOptional");else console.warn("In m-text-line tried to populateFromUrl but no defaultUrl")}},mounted:function(){if(this.defaultUrl&&this.defaultUrl.length){var a=this.dependsOn,b;for(b in a)a.hasOwnProperty(b)&&
this.fields&&this.$watch("fields."+b,function(){this.populateFromUrl({term:this.value})});this.defaultLoadInit&&this.populateFromUrl()}}});
Vue.component("m-chart",{name:"mChart",props:{config:{type:Object,required:!0},height:{type:String,"default":"400px"},width:{type:String,"default":"100%"}},template:'\x3cdiv class\x3d"chart-container" style\x3d"position:relative;" :style\x3d"{height:height,width:width}"\x3e\x3ccanvas ref\x3d"canvas"\x3e\x3c/canvas\x3e\x3c/div\x3e',data:function(){return{instance:null}},mounted:function(){var a=this;moqui.loadScript("https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js",function(b){b||
(a.instance=new Chart(a.$refs.canvas,a.config))},function(){return!!window.Chart})}});
Vue.component("m-ck-editor",{name:"mCkEditor",template:'\x3cdiv\x3e\x3ctextarea ref\x3d"area"\x3e\x3c/textarea\x3e\x3c/div\x3e',props:{value:{type:String,"default":""},useInline:Boolean,config:Object,readOnly:{type:Boolean,"default":null}},data:function(){return{destroyed:!1,ckeditor:null}},mounted:function(){var a=this;moqui.loadScript("https://cdn.ckeditor.com/4.14.1/standard-all/ckeditor.js",function(b){if(!b&&!a.destroyed){b=a.config||{};null!==a.readOnly&&(b.readOnly=a.readOnly);CKEDITOR.dtd.$removeEmpty.i=
!1;var c=a.ckeditor=CKEDITOR[a.useInline?"inline":"replace"](a.$refs.area,b);c.on("instanceReady",function(){var b=a.value;c.fire("lockSnapshot");c.setData(b,{callback:function(){c.on("change",function(b){var d=c.getData();a.value!==d&&a.$emit("input",d,b,c)});c.on("focus",function(b){a.$emit("focus",b,c)});c.on("blur",function(b){a.$emit("blur",b,c)});var e=c.getData();b!==e?(a.$once("input",function(){a.$emit("ready",c)}),a.$emit("input",e)):a.$emit("ready",c);c.fire("unlockSnapshot")}})})}},function(){return!!window.CKEDITOR})},
beforeDestroy:function(){this.ckeditor&&this.ckeditor.destroy();this.destroyed=!0},watch:{value:function(a){this.ckeditor&&this.ckeditor.getData()!==a&&this.ckeditor.setData(a)},readOnly:function(a){this.ckeditor&&this.ckeditor.setReadOnly(a)}}});
Vue.component("m-simple-mde",{name:"mSimpleMde",template:'\x3cdiv\x3e\x3ctextarea ref\x3d"area"\x3e\x3c/textarea\x3e\x3c/div\x3e',props:{value:{type:String,"default":""},config:Object},data:function(){return{simplemde:null}},mounted:function(){var a=this;moqui.loadStylesheet("https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2/simplemde.min.css");moqui.loadScript("https://cdnjs.cloudflare.com/ajax/libs/simplemde/1.11.2/simplemde.min.js",function(b){if(!b){b=Object.assign({element:a.$refs.area,
initialValue:a.value},a.config);var c=a.simplemde=new SimpleMDE(b);c.codemirror.on("change",function(b,e){if("setValue"!==e.origin){var f=c.value();a.$emit("input",f)}});c.codemirror.on("blur",function(){var b=c.value();a.$emit("blur",b)});a.$nextTick(function(){a.$emit("initialized",c)})}},function(){return!!window.SimpleMDE})},watch:{value:function(a){this.simplemde&&this.simplemde.value()!==a&&this.simplemde.value(a)}}});
Vue.component("m-subscreens-tabs",{name:"mSubscreensTabs",data:function(){return{pathIndex:-1}},template:'\x3cdiv v-if\x3d"subscreens.length \x3e 1"\x3e\x3cq-tabs dense no-caps align\x3d"left" active-color\x3d"primary" indicator-color\x3d"primary" :value\x3d"activeTab"\x3e\x3cq-tab v-for\x3d"tab in subscreens" :key\x3d"tab.name" :name\x3d"tab.name" :label\x3d"tab.title" :disable\x3d"tab.disableLink" @click.prevent\x3d"goTo(tab.pathWithParams)"\x3e\x3c/q-tab\x3e\x3c/q-tabs\x3e\x3cq-separator class\x3d"q-mb-md"\x3e\x3c/q-separator\x3e\x3c/div\x3e',
methods:{goTo:function(a){this.$root.setUrl(this.$root.getLinkPath(a))}},computed:{subscreens:function(){if(!this.pathIndex||0>this.pathIndex)return[];var a=this.$root.navMenuList[this.pathIndex];return a&&a.subscreens?a.subscreens:[]},activeTab:function(){if(!this.pathIndex||0>this.pathIndex)return null;var a=this.$root.navMenuList[this.pathIndex];if(!a||!a.subscreens)return null;var b=null;$.each(a.subscreens,function(a,d){d.active&&(b=d.name)});return b}},mounted:function(){this.pathIndex=this.$root.activeSubscreens.length}});
Vue.component("m-subscreens-active",{name:"mSubscreensActive",data:function(){return{activeComponent:moqui.EmptyComponent,pathIndex:-1,pathName:null}},template:'\x3ccomponent :is\x3d"activeComponent"\x3e\x3c/component\x3e',methods:{loadActive:function(){var a=this,b=a.$root,c=a.pathIndex,d=b.currentPathList,e=d[c],f=this.pathName!==e;this.pathName=e;if(!e||0===e.length)return console.info("in m-subscreens-active newPath is empty, loading EmptyComponent and returning true"),this.activeComponent=moqui.EmptyComponent,
!0;e=b.basePath+"/"+d.slice(0,c+1).join("/");if(!f&&moqui.componentCache.containsKey(e))return!1;f={path:e};c===d.length-1&&(d=b.extraPathList)&&0<d.length&&(f.extraPath=d.join("/"));(d=b.currentSearch)&&0<d.length&&(f.search=d);f.bodyParameters=b.bodyParameters;(d=b.navMenuList[c+b.basePathSize])&&d.renderModes&&(f.renderModes=d.renderModes);console.info("m-subscreens-active loadActive pathIndex "+c+" pathName "+a.pathName+" urlInfo "+JSON.stringify(f));b.loading++;b.currentLoadRequest=moqui.loadComponent(f,
function(c){b.currentLoadRequest=null;a.activeComponent=c;b.loading--});return!0}},mounted:function(){this.$root.addSubscreen(this)}});
Vue.component("m-menu-nav-item",{name:"mMenuNavItem",props:{menuIndex:Number},template:'\x3cq-expansion-item v-if\x3d"navMenuItem \x26\x26 navMenuItem.subscreens \x26\x26 navMenuItem.subscreens.length" :value\x3d"true" :content-inset-level\x3d"0.3" switch-toggle-side dense dense-toggle expanded-icon\x3d"arrow_drop_down" :to\x3d"navMenuItem.pathWithParams" @input\x3d"go"\x3e\x3ctemplate v-slot:header\x3e\x3cm-menu-item-content :menu-item\x3d"navMenuItem" active\x3e\x3c/m-menu-item-content\x3e\x3c/template\x3e\x3ctemplate v-slot:default\x3e\x3cm-menu-subscreen-item v-for\x3d"(subscreen, ssIndex) in navMenuItem.subscreens" :key\x3d"subscreen.name" :menu-index\x3d"menuIndex" :subscreen-index\x3d"ssIndex"\x3e\x3c/m-menu-subscreen-item\x3e\x3c/template\x3e\x3c/q-expansion-item\x3e\x3cq-expansion-item v-else-if\x3d"navMenuItem \x26\x26 navMenuItem.savedFinds \x26\x26 navMenuItem.savedFinds.length" :value\x3d"true" :content-inset-level\x3d"0.3" switch-toggle-side dense dense-toggle expanded-icon\x3d"arrow_drop_down" :to\x3d"navMenuItem.pathWithParams" @input\x3d"go"\x3e\x3ctemplate v-slot:header\x3e\x3cm-menu-item-content :menu-item\x3d"navMenuItem" active\x3e\x3c/m-menu-item-content\x3e\x3c/template\x3e\x3ctemplate v-slot:default\x3e\x3cq-expansion-item v-for\x3d"(savedFind, ssIndex) in navMenuItem.savedFinds" :key\x3d"savedFind.name" :value\x3d"false" switch-toggle-side dense dense-toggle expand-icon\x3d"chevron_right" :to\x3d"savedFind.pathWithParams" @input\x3d"goPath(savedFind.pathWithParams)"\x3e\x3ctemplate v-slot:header\x3e\x3cm-menu-item-content :menu-item\x3d"savedFind" :active\x3d"savedFind.active"/\x3e\x3c/template\x3e\x3c/q-expansion-item\x3e\x3c/template\x3e\x3c/q-expansion-item\x3e\x3cq-expansion-item v-else-if\x3d"menuIndex \x3c (navMenuLength - 1)" :value\x3d"true" :content-inset-level\x3d"0.3" switch-toggle-side dense dense-toggle expanded-icon\x3d"arrow_drop_down" :to\x3d"navMenuItem.pathWithParams" @input\x3d"go"\x3e\x3ctemplate v-slot:header\x3e\x3cm-menu-item-content :menu-item\x3d"navMenuItem" active\x3e\x3c/m-menu-item-content\x3e\x3c/template\x3e\x3ctemplate v-slot:default\x3e\x3cm-menu-nav-item :menu-index\x3d"menuIndex + 1"\x3e\x3c/m-menu-nav-item\x3e\x3c/template\x3e\x3c/q-expansion-item\x3e\x3cq-expansion-item v-else-if\x3d"navMenuItem" :value\x3d"false" switch-toggle-side dense dense-toggle expand-icon\x3d"arrow_right" :to\x3d"navMenuItem.pathWithParams" @input\x3d"go"\x3e\x3ctemplate v-slot:header\x3e\x3cm-menu-item-content :menu-item\x3d"navMenuItem" active\x3e\x3c/m-menu-item-content\x3e\x3c/template\x3e\x3c/q-expansion-item\x3e',methods:{go:function(){this.$root.setUrl(this.navMenuItem.pathWithParams)},
goPath:function(a){this.$root.setUrl(a)}},computed:{navMenuItem:function(){return this.$root.navMenuList[this.menuIndex]},navMenuLength:function(){return this.$root.navMenuList.length}}});
Vue.component("m-menu-subscreen-item",{name:"mMenuSubscreenItem",props:{menuIndex:Number,subscreenIndex:Number},template:'\x3cm-menu-nav-item v-if\x3d"subscreen.active" :menu-index\x3d"menuIndex + 1"\x3e\x3c/m-menu-nav-item\x3e\x3cq-expansion-item v-else :value\x3d"false" switch-toggle-side dense dense-toggle expand-icon\x3d"arrow_right" :to\x3d"subscreen.pathWithParams" @input\x3d"go"\x3e\x3ctemplate v-slot:header\x3e\x3cm-menu-item-content :menu-item\x3d"subscreen"\x3e\x3c/m-menu-item-content\x3e\x3c/template\x3e\x3c/q-expansion-item\x3e',methods:{go:function(){this.$root.setUrl(this.subscreen.pathWithParams)}},
computed:{subscreen:function(){return this.$root.navMenuList[this.menuIndex].subscreens[this.subscreenIndex]}}});Vue.component("m-menu-item-content",{name:"mMenuItemContent",props:{menuItem:Object,active:Boolean},template:'\x3cdiv class\x3d"q-item__section column q-item__section--main justify-center"\x3e\x3cdiv class\x3d"q-item__label"\x3e\x3ci v-if\x3d"menuItem.image \x26\x26 menuItem.imageType \x3d\x3d\x3d \'icon\'" :class\x3d"menuItem.image" style\x3d"padding-right: 8px;"\x3e\x3c/i\x3e\x3cspan v-else-if\x3d"menuItem.image" style\x3d"padding-right:8px;"\x3e\x3cimg :src\x3d"menuItem.image" :alt\x3d"menuItem.title" height\x3d"14" class\x3d"invertible"\x3e\x3c/span\x3e\x3cspan :class\x3d"{\'text-primary\':active}"\x3e{{menuItem.title}}\x3c/span\x3e\x3c/div\x3e\x3c/div\x3e'});
moqui.webrootVue=new Vue({el:"#apps-root",data:{basePath:"",linkBasePath:"",currentPathList:[],extraPathList:[],currentParameters:{},bodyParameters:null,activeSubscreens:[],navMenuList:[],navHistoryList:[],navPlugins:[],accountPlugins:[],notifyHistoryList:[],lastNavTime:Date.now(),loading:0,currentLoadRequest:null,activeContainers:{},moquiSessionToken:"",appHost:"",appRootPath:"",userId:"",locale:"en",notificationClient:null,qzVue:null,leftOpen:!1,moqui:moqui},methods:{setUrl:function(a,b,c){this.currentLoadRequest&&
(console.log("Aborting current page load currentLinkUrl "+this.currentLinkUrl+" url "+a),this.currentLoadRequest.abort(),this.currentLoadRequest=null,this.loading=0);this.bodyParameters=b;a=this.getLinkPath(a);if(this.currentLinkUrl===a&&a!==this.linkBasePath)this.reloadSubscreens(),c&&this.callOnComplete(c,this.currentPath);else{var d=this.currentPath;b=moqui.parseHref(a);this.extraPathList=[];this.currentSearch=b.search;this.currentPath=b.path;b=this.currentSearch;if((b=this.currentPath+(0<b.length?
"?"+b:""))&&0!==b.length){console.info("Current URL changing to "+b);this.lastNavTime=Date.now();this.activeContainers={};var e=this;b=this.appRootPath&&this.appRootPath.length&&0===b.indexOf(this.appRootPath)?this.appRootPath+"/menuData"+b.slice(this.appRootPath.length):"/menuData"+b;$.ajax({type:"GET",url:b,dataType:"text",error:moqui.handleAjaxError,success:function(a){var b=null;try{b=JSON.parse(a)}catch(m){console.info("Error parson menu list JSON: "+m)}b&&moqui.isArray(b)&&(e.navMenuList=b,
c&&e.callOnComplete(c,d))}});window.history.pushState(null,this.ScreenTitle,a);document.documentElement.scrollTop=0;document.body.scrollTop=0}}},callOnComplete:function(a,b){if(a){var c=this.getRoute();b&&(c.redirectedFrom=b);a(c)}},getRoute:function(){return{name:this.currentPathList[this.currentPathList.length-1],meta:{},path:this.currentPath,hash:"",query:this.currentParameters,params:this.bodyParameters||{},fullPath:this.currentLinkUrl,matched:[]}},setParameters:function(a){a&&(this.$root.currentParameters=
$.extend({},this.$root.currentParameters,a));this.$root.reloadSubscreens()},addSubscreen:function(a){a.pathIndex=this.activeSubscreens.length;a.loadActive();this.activeSubscreens.push(a)},reloadSubscreens:function(){var a=this.currentPathList,b=this.activeSubscreens;console.info("reloadSubscreens currentPathList "+JSON.stringify(this.currentPathList));if(0===a.length&&0<b.length)b.splice(1),b[0].loadActive();else for(var c=0;c<b.length&&!(c>=a.length);c++)b[c].loadActive()&&b.splice(c+1)},goPreviousScreen:function(){for(var a=
this.currentPath,b=this.navHistoryList,c,d=0;d<b.length;d++)if(0>b[d].pathWithParams.indexOf(a)){c=b[d];break}c&&c.pathWithParams&&c.pathWithParams.length&&this.setUrl(c.pathWithParams)},addContainer:function(a,b){this.activeContainers[a]=b},reloadContainer:function(a){var b=this.activeContainers[a];b?b.reload():console.error("Container with ID "+a+" not found, not reloading")},loadContainer:function(a,b){var c=this.activeContainers[a];c?c.load(b):console.error("Container with ID "+a+" not found, not loading url "+
b)},addNavPlugin:function(a){var b=this;moqui.loadComponent(this.appRootPath+a,function(a){b.navPlugins.push(a)})},addNavPluginsWait:function(a,b){if(a&&a.length>b){this.addNavPlugin(a[b]);var c=this;a.length>b+1&&setTimeout(function(){c.addNavPluginsWait(a,b+1)},500)}},addAccountPlugin:function(a){var b=this;moqui.loadComponent(this.appRootPath+a,function(a){b.accountPlugins.push(a)})},addAccountPluginsWait:function(a,b){if(a&&a.length>b){this.addAccountPlugin(a[b]);var c=this;a.length>b+1&&setTimeout(function(){c.addAccountPluginsWait(a,
b+1)},500)}},addNotify:function(a,b){var c=this.notifyHistoryList.slice(0),d=new Date,e=d.getHours();10>e&&(e="0"+e);d=d.getMinutes();10>d&&(d="0"+d);for(c.unshift({message:a,type:b,time:e+":"+d});25<c.length;)c.pop();this.notifyHistoryList=c},switchDarkLight:function(){this.$q.dark.toggle();$.ajax({type:"POST",url:this.appRootPath+"/apps/setPreference",error:moqui.handleAjaxError,data:{moquiSessionToken:this.moquiSessionToken,preferenceKey:"QUASAR_DARK",preferenceValue:this.$q.dark.isActive?"true":
"false"}})},toggleLeftOpen:function(){this.leftOpen=!this.leftOpen;$.ajax({type:"POST",url:this.appRootPath+"/apps/setPreference",error:moqui.handleAjaxError,data:{moquiSessionToken:this.moquiSessionToken,preferenceKey:"QUASAR_LEFT_OPEN",preferenceValue:this.leftOpen?"true":"false"}})},stopProp:function(a){a.stopPropagation()},getNavHref:function(a){a||(a=this.navMenuList.length-1);a=this.navMenuList[a];if(a.extraPathList&&a.extraPathList.length){var b=a.path+"/"+a.extraPathList.join("/"),c=a.pathWithParams.indexOf("?");
0<c&&(b+=a.pathWithParams.slice(c));return b}return a.pathWithParams||a.path},getLinkPath:function(a){moqui.isPlainObject(a)&&(a=moqui.makeHref(a));this.appRootPath&&this.appRootPath.length&&0!==a.indexOf(this.appRootPath)&&(a=this.appRootPath+a);var b=a.split("/"),c=this.appRootPath?2:1;b.length>c&&(b[c]=this.linkBasePath.slice(1),a=b.join("/"));return a},getQuasarColor:function(a){return moqui.getQuasarColor(a)}},watch:{navMenuList:function(a){if(0<a.length){var b=a[a.length-1];a=1<a.length?a[a.length-
2]:null;b.extraPathList&&(this.extraPathList=b.extraPathList);var c=this.basePathSize,d=b.path.split("/").slice(c+1);console.info("nav updated fullPath "+JSON.stringify(d)+" currentPathList "+JSON.stringify(this.currentPathList)+" cur.path "+b.path+" basePathSize "+c);this.currentPathList=d;this.reloadSubscreens();a=(a?a.title+" - ":"")+b.title;var c=b.pathWithParams,e=c.indexOf("?");if(0<e){for(var d=["pageIndex","orderBySelect","orderByField","moquiSessionToken"],f=c.substring(e+1).split("\x26"),
c=c.substring(0,e),e=0,g="",m=0;m<f.length;m++){var k=f[m],c=-1===c.indexOf("?")?c+"?":c+"\x26",c=c+k;if(!(3<e)){var h=k.indexOf("\x3d");if(0<h){var l=k.substring(0,h),k=k.substring(h+1);0<l.indexOf("_op")||0<l.indexOf("_not")||0<l.indexOf("_ic")||0<d.indexOf(l)||l===k||(0<g.length&&(g+=", "),g+=decodeURIComponent(k),e++)}}}0<g.length&&(70<g.length&&(g=g.substring(0,70)+"..."),a=a+" ("+g+")")}d=this.navHistoryList;for(f=0;f<d.length;)d[f].pathWithParams===c?d.splice(f,1):f++;for(d.unshift({title:a,
pathWithParams:c,image:b.image,imageType:b.imageType});25<d.length;)d.pop();document.title=a}},currentPathList:function(a){(a=a[a.length-1])&&$(this.$el).removeClass().addClass(a)}},computed:{currentPath:{get:function(){var a=this.currentPathList,b=this.extraPathList;return this.basePath+(a&&0<a.length?"/"+a.join("/"):"")+(b&&0<b.length?"/"+b.join("/"):"")},set:function(a){a&&0!==a.length?("/"===a.slice(a.length-1)&&(a=a.slice(0,a.length-1)),0===a.indexOf(this.linkBasePath)?a=a.slice(this.linkBasePath.length+
1):0===a.indexOf(this.basePath)&&(a=a.slice(this.basePath.length+1)),this.currentPathList=a.split("/")):this.currentPathList=[]}},currentLinkPath:function(){var a=this.currentPathList,b=this.extraPathList;return this.linkBasePath+(a&&0<a.length?"/"+a.join("/"):"")+(b&&0<b.length?"/"+b.join("/"):"")},currentSearch:{get:function(){return moqui.objToSearch(this.currentParameters)},set:function(a){this.currentParameters=moqui.searchToObj(a)}},currentLinkUrl:function(){var a=this.currentSearch;return this.currentLinkPath+
(0<a.length?"?"+a:"")},basePathSize:function(){return this.basePath.split("/").length-this.appRootPath.split("/").length},ScreenTitle:function(){return 0<this.navMenuList.length?this.navMenuList[this.navMenuList.length-1].title:""},documentMenuList:function(){for(var a=[],b=0;b<this.navMenuList.length;b++){var c=this.navMenuList[b].screenDocList;c&&c.length&&c.forEach(function(b){a.push(b)})}return a}},created:function(){this.moquiSessionToken=$("#confMoquiSessionToken").val();this.appHost=$("#confAppHost").val();
this.appRootPath=$("#confAppRootPath").val();this.basePath=$("#confBasePath").val();this.linkBasePath=$("#confLinkBasePath").val();this.userId=$("#confUserId").val();this.locale=$("#confLocale").val();moqui.localeMap[this.locale]&&(this.locale=moqui.localeMap[this.locale]);this.leftOpen="true"===$("#confLeftOpen").val();var a=$("#confDarkMode").val();this.$q.dark.set("true"===a);this.notificationClient=new moqui.NotificationClient(("https:"===location.protocol?"wss://":"ws://")+this.appHost+this.appRootPath+
"/notws");var b=[];$(".confNavPluginUrl").each(function(a,c){b.push($(c).val())});this.addNavPluginsWait(b,0);var c=[];$(".confAccountPluginUrl").each(function(a,b){c.push($(b).val())});this.addAccountPluginsWait(c,0)},mounted:function(){$(this.$el).css("display","initial");this.setUrl(window.location.pathname+window.location.search);this.notificationClient.registerListener("ALL");window.Notification&&"granted"!==Notification.permission&&"denied"!==Notification.permission&&Notification.requestPermission(function(a){"granted"===
a?moqui.notifyMessages("Browser notifications enabled, if you don't want them use browser notification settings to block"):"denied"===a&&moqui.notifyMessages("Browser notifications disabled, if you want them use browser notification settings to allow")})}});window.addEventListener("popstate",function(){moqui.webrootVue.setUrl(window.location.pathname+window.location.search)});
moqui.webrootRouter={resolve:function(a,b,c){a=moqui.isString(a)?moqui.parseHref(a):a;b=a.path;moqui.webrootVue&&(a.path=b=moqui.webrootVue.getLinkPath(b));c=b.lastIndexOf("/");b={name:-1===c?b:b.slice(c+1),meta:{},path:b,hash:a.hash||"",query:a.query||"",params:{},fullPath:b,matched:[]};return{location:a,route:b,href:moqui.makeHref(a),normalizedTo:a,resolved:b}},replace:function(a,b,c){moqui.webrootVue.setUrl(a,null,b)},push:function(a,b,c){moqui.webrootVue.setUrl(a,null,b)}};
Object.defineProperty(Vue.prototype,"$router",{get:function(){return moqui.webrootRouter}});Object.defineProperty(Vue.prototype,"$route",{get:function(){return moqui.webrootVue.getRoute()}});